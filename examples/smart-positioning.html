<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Torchlit — Smart Positioning Example</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      color: #18181b;
      min-height: 200vh; /* Force scrolling to test scroll-and-settle */
    }
    .header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #1e293b;
      color: white;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 { font-size: 1rem; margin: 0; }
    .header-actions { display: flex; gap: 0.5rem; }
    button {
      padding: 0.4rem 0.875rem;
      background: #F26122;
      color: white;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      font-weight: 500;
      font-family: inherit;
      font-size: 0.8125rem;
    }
    button:hover { background: #BF4A1A; }
    .btn-sm {
      padding: 0.3rem 0.625rem;
      font-size: 0.75rem;
    }
    .content { padding: 1.5rem; max-width: 900px; margin: 0 auto; }
    p.intro { color: #6b7280; margin-bottom: 1.5rem; line-height: 1.6; font-size: 0.875rem; }
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .card {
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      padding: 1.25rem;
    }
    .card strong { display: block; margin-bottom: 0.25rem; font-size: 0.875rem; }
    .card p { color: #6b7280; font-size: 0.8125rem; line-height: 1.5; margin: 0; }

    /* Elements at viewport edges to force flipping */
    .edge-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2rem;
    }
    .edge-box {
      background: #dbeafe;
      border: 1px solid #93c5fd;
      border-radius: 0.5rem;
      padding: 1rem 1.25rem;
      font-size: 0.8125rem;
      color: #1e40af;
      font-weight: 500;
    }

    /* Bottom section — far down the page */
    .bottom-section {
      margin-top: 300px;
      padding: 2rem;
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 0.75rem;
    }
    .bottom-section strong { display: block; margin-bottom: 0.25rem; }
    .bottom-section p { color: #92400e; font-size: 0.875rem; line-height: 1.5; margin: 0; }

    .corner-tl, .corner-tr, .corner-bl, .corner-br {
      position: absolute;
      width: 80px;
      height: 40px;
      background: #fce7f3;
      border: 1px solid #f9a8d4;
      border-radius: 0.375rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6875rem;
      font-weight: 600;
      color: #be185d;
    }
    .corner-tl { top: 64px; left: 8px; }
    .corner-tr { top: 64px; right: 8px; }

    code {
      font-family: ui-monospace, monospace;
      font-size: 0.75rem;
      background: #f3f4f6;
      padding: 0.1em 0.35em;
      border-radius: 0.25rem;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>Smart Positioning Demo</h1>
    <div class="header-actions">
      <button id="start-tour">Start Tour</button>
    </div>
  </div>

  <!-- Elements hugging viewport edges -->
  <div class="corner-tl" data-tour-id="corner-tl">Top-left</div>
  <div class="corner-tr" data-tour-id="corner-tr">Top-right</div>

  <div class="content">
    <p class="intro">
      This example demonstrates Torchlit's <strong>smart auto-positioning</strong>. Every step
      requests a specific <code>placement</code>, but the tooltip automatically flips to the
      opposite or perpendicular side when it would clip the viewport. The arrow tracks the
      target's center regardless of where the tooltip lands.
    </p>

    <div class="edge-container">
      <div class="edge-box" data-tour-id="left-edge">
        Left edge element
      </div>
      <div class="edge-box" data-tour-id="right-edge">
        Right edge element
      </div>
    </div>

    <div class="grid">
      <div class="card" data-tour-id="card-a">
        <strong>Card A</strong>
        <p>Placement: bottom (should fit normally).</p>
      </div>
      <div class="card" data-tour-id="card-b">
        <strong>Card B</strong>
        <p>Placement: left (tests horizontal flip).</p>
      </div>
      <div class="card" data-tour-id="card-c">
        <strong>Card C</strong>
        <p>Placement: right (tests horizontal space).</p>
      </div>
    </div>

    <div class="card" data-tour-id="spotlight-shapes" style="text-align: center;">
      <strong>Spotlight Shapes</strong>
      <p>This step uses <code>spotlightBorderRadius: '9999px'</code> for a pill-shaped spotlight.</p>
    </div>

    <div class="bottom-section" data-tour-id="scrolled-target">
      <strong>Scrolled Target</strong>
      <p>
        This element is far down the page. The overlay uses <code>scrollAndSettle</code> —
        it scrolls here smoothly and waits for the scroll to finish before positioning the tooltip.
      </p>
    </div>
  </div>

  <torchlit-overlay></torchlit-overlay>

  <script type="module">
    // In a real project: import from 'torchlit'
    import { createTourService, TorchlitOverlay } from '../src/index.ts';

    if (!customElements.get('torchlit-overlay')) {
      customElements.define('torchlit-overlay', TorchlitOverlay);
    }

    const tours = createTourService({ storageKey: 'positioning-example' });
    const overlay = document.querySelector('torchlit-overlay');
    overlay.service = tours;

    tours.register({
      id: 'positioning-demo',
      name: 'Smart Positioning Demo',
      trigger: 'manual',
      steps: [
        {
          target: '_none_',
          title: 'Smart Positioning',
          message:
            'This tour places tooltips in tricky positions — near edges, corners, and ' +
            'off-screen elements. Watch how the tooltip flips automatically.',
          placement: 'bottom',
        },
        {
          target: 'corner-tl',
          title: 'Top-Left Corner',
          message:
            'Requested placement: left. But there\'s no room on the left, ' +
            'so Torchlit flips to the right or bottom.',
          placement: 'left',
        },
        {
          target: 'corner-tr',
          title: 'Top-Right Corner',
          message:
            'Requested placement: right. No room on the right, ' +
            'so the tooltip flips to the left or below.',
          placement: 'right',
        },
        {
          target: 'left-edge',
          title: 'Left Edge',
          message:
            'Requested placement: left. The tooltip auto-positions to the side ' +
            'with the most space. Arrow still points at the target.',
          placement: 'left',
        },
        {
          target: 'right-edge',
          title: 'Right Edge',
          message:
            'Requested placement: right. Same logic — flip when clipping, ' +
            'keep the arrow accurate.',
          placement: 'right',
        },
        {
          target: 'card-a',
          title: 'Normal Placement',
          message: 'Requested: bottom. Plenty of room, so it stays where you asked.',
          placement: 'bottom',
        },
        {
          target: 'card-b',
          title: 'Horizontal Flip',
          message:
            'Requested: left. Depending on your viewport width, this may flip ' +
            'to the right or below.',
          placement: 'left',
        },
        {
          target: 'spotlight-shapes',
          title: 'Pill Spotlight',
          message: 'This step has spotlightBorderRadius: \'9999px\' — a pill-shaped cutout.',
          placement: 'top',
          spotlightBorderRadius: '9999px',
        },
        {
          target: 'scrolled-target',
          title: 'Scroll & Settle',
          message:
            'This element was off-screen. Torchlit scrolled to it smoothly and waited ' +
            'for the scroll to finish before showing the tooltip. No fixed timeouts.',
          placement: 'top',
        },
      ],
    });

    document.getElementById('start-tour').addEventListener('click', () => {
      tours.start('positioning-demo');
    });
  </script>
</body>
</html>
