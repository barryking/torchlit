<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Torchlit — Docs</title>

  <!-- ── Fonts ─────────────────────────────────────────────────────── -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700&display=swap" rel="stylesheet" />

  <!-- ── Prism.js syntax highlighting ──────────────────────────────── -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

  <!-- ── Theme tokens ──────────────────────────────────────────────── -->
  <style>
    :root {
      /* Primary Palette — Torch Orange */
      --primary: #F26122;
      --primary-dark: #BF4A1A;
      --primary-light: #FF8C59;
      --primary-foreground: #fff;

      /* Neutrals */
      --background: #F5F6F7;
      --foreground: #2D2D2D;
      --card: #ffffff;
      --border: #E0E2E5;
      --muted: #ECEDF0;
      --muted-foreground: #6B7280;

      /* Accents */
      --accent-blue: #2F80ED;
      --accent-green: #27AE60;

      /* Radii */
      --radius-sm: 0.375rem;
      --radius-md: 0.5rem;
      --radius-lg: 0.75rem;
      --radius-xl: 1rem;

      /* Shadows — slightly warmer tone */
      --shadow-sm: 0 1px 2px rgba(45,45,45,0.05);
      --shadow-md: 0 4px 12px rgba(45,45,45,0.08);
      --shadow-lg: 0 12px 40px rgba(45,45,45,0.12);
    }

    :root.dark {
      --primary: #FF8C59;
      --primary-dark: #F26122;
      --primary-light: #FFAB82;
      --primary-foreground: #1a1a1a;

      --background: #1A1A1A;
      --foreground: #E8E8E8;
      --card: #252525;
      --border: #3A3A3A;
      --muted: #2F2F2F;
      --muted-foreground: #9CA3AF;

      --accent-blue: #5B9CF0;
      --accent-green: #4ACD80;

      --shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.3);
      --shadow-lg: 0 12px 40px rgba(0,0,0,0.4);
    }

    /* ── Reset & base ────────────────────────────────────────────── */

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', system-ui, sans-serif;
      background: var(--background);
      color: var(--foreground);
      min-height: 100vh;
      transition: background 0.3s, color 0.3s;
    }

    /* ── Layout ──────────────────────────────────────────────────── */

    .app {
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: 56px 1fr;
      min-height: 100vh;
    }

    /* ── Header ──────────────────────────────────────────────────── */

    .header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.25rem;
      background: var(--card);
      border-bottom: 1px solid var(--border);
      z-index: 10;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo {
      width: 28px;
      height: 28px;
      background: var(--primary);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo svg { color: var(--primary-foreground); }

    .app-name {
      font-size: 0.9375rem;
      font-weight: 600;
      letter-spacing: -0.01em;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .icon-btn {
      width: 34px;
      height: 34px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--muted-foreground);
      cursor: pointer;
      transition: all 0.15s;
    }

    .icon-btn:hover {
      background: var(--muted);
      color: var(--primary);
    }

    .icon-btn svg {
      width: 16px;
      height: 16px;
    }

    /* ── Sidebar ─────────────────────────────────────────────────── */

    .sidebar {
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 1rem 0.75rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .sidebar-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted-foreground);
      padding: 0.5rem 0.75rem 0.375rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.625rem;
      padding: 0.5rem 0.75rem;
      border-radius: var(--radius-md);
      font-size: 0.8125rem;
      font-weight: 500;
      color: var(--muted-foreground);
      cursor: pointer;
      transition: all 0.15s;
      border: none;
      background: none;
      width: 100%;
      text-align: left;
      font-family: inherit;
    }

    .nav-item:hover {
      background: var(--muted);
      color: var(--foreground);
    }

    .nav-item.active {
      background: var(--primary);
      color: var(--primary-foreground);
    }

    .nav-item svg {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .sidebar-spacer { flex: 1; }

    .sidebar-footer {
      padding: 0.75rem;
      border-top: 1px solid var(--border);
      margin-top: 0.5rem;
    }

    .sidebar-footer-text {
      font-size: 0.6875rem;
      color: var(--muted-foreground);
      line-height: 1.5;
    }

    .sidebar-footer-text code {
      font-family: 'Fira Code', monospace;
      font-size: 0.625rem;
      background: var(--muted);
      padding: 0.1em 0.35em;
      border-radius: var(--radius-sm);
    }

    /* ── Main content ────────────────────────────────────────────── */

    .main {
      padding: 2rem;
      overflow-y: auto;
    }

    .page { display: none; }
    .page.active { display: block; }

    .page-title, .app-name, .card-title, .stat-value {
      font-family: 'Poppins', 'Inter', system-ui, sans-serif;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 0.375rem;
    }

    .page-subtitle {
      font-size: 0.875rem;
      color: var(--muted-foreground);
      margin-bottom: 1.75rem;
      line-height: 1.5;
    }

    /* ── Cards grid ──────────────────────────────────────────────── */

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.25rem;
      transition: box-shadow 0.2s, transform 0.2s;
    }

    .card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-1px);
    }

    .card-icon {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 0.75rem;
      color: #fff;
    }

    .card-icon.blue   { background: #2F80ED; }
    .card-icon.green  { background: #27AE60; }
    .card-icon.amber  { background: #F26122; }
    .card-icon.rose   { background: #BF4A1A; }

    :root.dark .card-icon.blue   { background: #5B9CF0; }
    :root.dark .card-icon.green  { background: #4ACD80; }
    :root.dark .card-icon.amber  { background: #FF8C59; }
    :root.dark .card-icon.rose   { background: #F26122; }

    .card-icon svg { width: 18px; height: 18px; }

    .card-title {
      font-size: 0.875rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .card-desc {
      font-size: 0.8125rem;
      color: var(--muted-foreground);
      line-height: 1.5;
    }

    /* ── Stats bar ───────────────────────────────────────────────── */

    .stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
      gap: 1rem;
      margin-bottom: 1.75rem;
    }

    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1rem 1.25rem;
    }

    .stat-label {
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted-foreground);
      margin-bottom: 0.25rem;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    /* ── Search bar ──────────────────────────────────────────────── */

    .search-bar {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: var(--muted);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      margin-bottom: 1.5rem;
      color: var(--muted-foreground);
      font-size: 0.8125rem;
    }

    .search-bar svg {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
    }

    .search-bar input {
      all: unset;
      flex: 1;
      font-family: inherit;
      font-size: inherit;
      color: var(--foreground);
    }

    .search-bar input::placeholder {
      color: var(--muted-foreground);
    }

    /* ── Badge ───────────────────────────────────────────────────── */

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.6875rem;
      font-weight: 600;
      padding: 0.15rem 0.5rem;
      border-radius: 9999px;
      background: var(--muted);
      color: var(--muted-foreground);
    }

    .badge.primary {
      background: var(--primary);
      color: var(--primary-foreground);
    }

    /* ── Placeholder block ─────────────────────────────────────── */

    .placeholder-block {
      background: var(--muted);
      border-radius: var(--radius-lg);
      height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted-foreground);
      font-size: 0.8125rem;
      border: 1px dashed var(--border);
    }

    /* ═══════════════════════════════════════════════════════════════
       Documentation-specific styles
       ═══════════════════════════════════════════════════════════════ */

    /* ── Install command ─────────────────────────────────────────── */

    .install-cmd {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: #2d2b55;
      color: #e0def4;
      padding: 0.875rem 1.25rem;
      border-radius: var(--radius-lg);
      font-family: 'Fira Code', monospace;
      font-size: 0.8125rem;
      margin-bottom: 1.75rem;
      position: relative;
      overflow: hidden;
    }

    .install-cmd .prompt {
      color: #7c7a9c;
      user-select: none;
    }

    .install-cmd .cmd {
      flex: 1;
    }

    .install-cmd .copy-btn {
      background: none;
      border: 1px solid rgba(255,255,255,0.15);
      color: #9c99c4;
      padding: 0.25rem 0.5rem;
      border-radius: var(--radius-sm);
      font-size: 0.6875rem;
      font-family: 'Inter', system-ui, sans-serif;
      cursor: pointer;
      transition: all 0.15s;
    }

    .install-cmd .copy-btn:hover {
      background: rgba(255,255,255,0.1);
      color: #e0def4;
    }

    /* ── Doc sections ────────────────────────────────────────────── */

    .doc-section {
      margin-top: 2rem;
      margin-bottom: 1.5rem;
    }

    .doc-section:first-child {
      margin-top: 0;
    }

    .section-title {
      font-family: 'Poppins', 'Inter', system-ui, sans-serif;
      font-size: 1.125rem;
      font-weight: 700;
      letter-spacing: -0.01em;
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border);
    }

    .subsection-title {
      font-family: 'Poppins', 'Inter', system-ui, sans-serif;
      font-size: 0.9375rem;
      font-weight: 600;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .doc-text {
      font-size: 0.8125rem;
      line-height: 1.7;
      color: var(--foreground);
      margin-bottom: 1rem;
    }

    .doc-text code {
      font-family: 'Fira Code', monospace;
      font-size: 0.75rem;
      background: var(--muted);
      padding: 0.15em 0.4em;
      border-radius: var(--radius-sm);
      color: var(--primary);
    }

    :root.dark .doc-text code {
      color: var(--primary-light, #FFAB82);
    }

    /* ── Code blocks (Prism.js overrides) ────────────────────────── */

    pre[class*="language-"] {
      border-radius: var(--radius-lg);
      margin: 0 0 1rem;
      font-size: 0.8125rem;
      line-height: 1.6;
      border: 1px solid var(--border);
    }

    code[class*="language-"] {
      font-family: 'Fira Code', monospace;
      font-size: 0.8125rem;
    }

    .code-label {
      display: inline-block;
      font-size: 0.6875rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--muted-foreground);
      margin-bottom: 0.375rem;
    }

    /* ── Reference tables ────────────────────────────────────────── */

    .ref-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8125rem;
      margin-bottom: 1.5rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .ref-table th {
      text-align: left;
      padding: 0.625rem 1rem;
      background: var(--muted);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted-foreground);
      border-bottom: 1px solid var(--border);
    }

    .ref-table td {
      padding: 0.5rem 1rem;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      line-height: 1.5;
    }

    .ref-table tr:last-child td {
      border-bottom: none;
    }

    .ref-table code {
      font-family: 'Fira Code', monospace;
      font-size: 0.75rem;
      background: var(--muted);
      padding: 0.1em 0.35em;
      border-radius: var(--radius-sm);
      white-space: nowrap;
    }

    .ref-table .sig {
      color: var(--primary);
      font-family: 'Fira Code', monospace;
      font-size: 0.75rem;
    }

    :root.dark .ref-table .sig {
      color: var(--primary-light, #FFAB82);
    }

    /* ── Step list (Getting Started) ─────────────────────────────── */

    .step {
      position: relative;
      padding-left: 2.5rem;
      margin-bottom: 1.5rem;
    }

    .step-number {
      position: absolute;
      left: 0;
      top: 0;
      width: 1.75rem;
      height: 1.75rem;
      border-radius: 50%;
      background: var(--primary);
      color: var(--primary-foreground);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: 700;
      font-family: 'Poppins', system-ui, sans-serif;
    }

    .step-title {
      font-family: 'Poppins', 'Inter', system-ui, sans-serif;
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 0.375rem;
    }

    .step .doc-text {
      margin-bottom: 0.5rem;
    }

    /* ── Kbd element ──────────────────────────────────────────────── */

    kbd {
      display: inline-block;
      padding: 0.1em 0.45em;
      font-family: 'Fira Code', monospace;
      font-size: 0.75rem;
      background: var(--muted);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      box-shadow: 0 1px 0 var(--border);
    }

    /* ── Interactive demo panel ────────────────────────────────────── */

    .demo-panel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .demo-tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      background: var(--muted);
    }

    .demo-tab {
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--muted-foreground);
      background: none;
      border: none;
      cursor: pointer;
      font-family: inherit;
      transition: color 0.15s, background 0.15s;
      border-bottom: 2px solid transparent;
      margin-bottom: -1px;
    }

    .demo-tab:hover {
      color: var(--foreground);
    }

    .demo-tab.active {
      color: var(--primary);
      background: var(--card);
      border-bottom-color: var(--primary);
    }

    .demo-content {
      display: none;
      padding: 1.25rem;
    }

    .demo-content.active {
      display: block;
    }

    .demo-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .demo-target {
      padding: 0.625rem 1rem;
      background: var(--muted);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      font-size: 0.8125rem;
      color: var(--foreground);
    }

    .demo-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-foreground);
      font-weight: 700;
      font-size: 0.875rem;
      flex-shrink: 0;
    }

    .demo-run {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      font-family: inherit;
      background: var(--primary);
      color: var(--primary-foreground);
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: opacity 0.15s;
    }

    .demo-run:hover { opacity: 0.9; }

    /* ── Theme playground ─────────────────────────────────────────── */

    .playground {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
    }

    .playground-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--muted);
    }

    .playground-header-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--foreground);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .playground-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0;
    }

    @media (max-width: 768px) {
      .playground-body {
        grid-template-columns: 1fr;
      }
    }

    .playground-controls {
      padding: 1.25rem;
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    @media (max-width: 768px) {
      .playground-controls {
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
    }

    .playground-control {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .playground-control label {
      font-size: 0.75rem;
      font-family: 'Fira Code', monospace;
      color: var(--muted-foreground);
      min-width: 160px;
      flex-shrink: 0;
    }

    .playground-control input[type="color"] {
      width: 28px;
      height: 28px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 1px;
      cursor: pointer;
      background: var(--card);
      flex-shrink: 0;
    }

    .playground-control input[type="text"] {
      flex: 1;
      min-width: 0;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      font-family: 'Fira Code', monospace;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      background: var(--background);
      color: var(--foreground);
    }

    .playground-preview {
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 340px;
      background: var(--muted);
      border-radius: 0 0 var(--radius-lg) 0;
      position: relative;
      overflow: hidden;
    }

    .playground-tooltip-mock {
      position: relative;
      width: 300px;
      border: 1px solid var(--pg-border, #e5e5e5);
      border-radius: var(--pg-tooltip-radius, 0.75rem);
      background: var(--pg-card, #fff);
      box-shadow: 0 20px 40px -8px rgba(0,0,0,0.2), 0 8px 16px -4px rgba(0,0,0,0.1);
      padding: 1.125rem;
    }

    .playground-tooltip-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.6875rem;
      font-weight: 600;
      color: var(--pg-primary, #F26122);
      margin-bottom: 0.5rem;
    }

    .playground-tooltip-badge svg {
      flex-shrink: 0;
    }

    .playground-tooltip-title {
      font-weight: 600;
      font-size: 1rem;
      color: var(--pg-foreground, #1a1a1a);
      margin-bottom: 0.375rem;
      line-height: 1.3;
    }

    .playground-tooltip-message {
      font-size: 0.8125rem;
      color: var(--pg-muted-fg, #737373);
      line-height: 1.55;
      margin-bottom: 1rem;
    }

    .playground-tooltip-dots {
      display: flex;
      gap: 0.375rem;
      margin-bottom: 1rem;
    }

    .playground-tooltip-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--pg-muted, #e5e5e5);
      transition: background 0.2s, transform 0.2s;
    }

    .playground-tooltip-dot.completed {
      background: var(--pg-primary, #F26122);
      opacity: 0.5;
    }

    .playground-tooltip-dot.active {
      background: var(--pg-primary, #F26122);
      transform: scale(1.3);
    }

    .playground-tooltip-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .playground-tooltip-skip {
      font-size: 0.75rem;
      color: var(--pg-muted-fg, #737373);
      background: none;
      border: none;
      cursor: default;
      padding: 0.25rem 0;
    }

    .playground-tooltip-nav {
      display: flex;
      gap: 0.5rem;
    }

    .playground-btn-secondary {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.4rem 0.875rem;
      font-size: 0.8125rem;
      font-weight: 500;
      font-family: inherit;
      border: 1px solid var(--pg-border, #e5e5e5);
      border-radius: var(--pg-btn-radius, 0.5rem);
      background: var(--pg-background, #fff);
      color: var(--pg-foreground, #1a1a1a);
      cursor: default;
    }

    .playground-btn-primary {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.4rem 0.875rem;
      font-size: 0.8125rem;
      font-weight: 500;
      font-family: inherit;
      border: 1px solid var(--pg-primary, #F26122);
      border-radius: var(--pg-btn-radius, 0.5rem);
      background: var(--pg-primary, #F26122);
      color: var(--pg-primary-fg, #fff);
      cursor: default;
    }

    .playground-btn-secondary svg,
    .playground-btn-primary svg {
      width: 14px;
      height: 14px;
    }


    .playground-code-wrap {
      border-top: 1px solid var(--border);
    }

    .playground-code-toggle {
      display: flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.5rem 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      font-family: inherit;
      color: var(--muted-foreground);
      background: none;
      border: none;
      cursor: pointer;
      width: 100%;
      text-align: left;
    }

    .playground-code-toggle:hover {
      color: var(--foreground);
    }

    .playground-code {
      display: none;
      padding: 0 1rem 1rem;
    }

    .playground-code.open {
      display: block;
    }

    .playground-code pre {
      margin: 0;
      font-size: 0.8125rem;
    }

    .playground-reset {
      font-size: 0.6875rem;
      font-weight: 600;
      font-family: inherit;
      padding: 0.25rem 0.625rem;
      color: var(--muted-foreground);
      background: var(--background);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: color 0.15s;
    }

    .playground-reset:hover {
      color: var(--foreground);
    }

    /* ── API pills (jump links) ───────────────────────────────────── */

    .api-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .api-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.3rem 0.75rem;
      font-size: 0.75rem;
      font-weight: 600;
      font-family: inherit;
      color: var(--foreground);
      background: var(--muted);
      border: 1px solid var(--border);
      border-radius: 9999px;
      cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
      text-decoration: none;
    }

    .api-pill:hover {
      background: var(--border);
      border-color: var(--muted-foreground);
    }

    .api-pill svg {
      width: 12px;
      height: 12px;
      opacity: 0.6;
    }

    /* ── API search dropdown ──────────────────────────────────────── */

    .search-bar-wrap {
      position: relative;
    }

    .api-search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      z-index: 100;
      margin-top: 0.25rem;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      box-shadow: 0 8px 24px -4px rgba(0, 0, 0, 0.12);
      max-height: 320px;
      overflow-y: auto;
      display: none;
    }

    .api-search-results.open {
      display: block;
    }

    .api-search-result {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      font-size: 0.8125rem;
      cursor: pointer;
      transition: background 0.1s;
      border-bottom: 1px solid var(--border);
    }

    .api-search-result:last-child {
      border-bottom: none;
    }

    .api-search-result:hover,
    .api-search-result.active {
      background: var(--muted);
    }

    .api-search-result code {
      font-family: 'Fira Code', ui-monospace, monospace;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--primary);
    }

    .api-search-result .result-context {
      color: var(--muted-foreground);
      font-size: 0.6875rem;
      margin-left: auto;
      white-space: nowrap;
    }

    @keyframes highlightFlash {
      0%   { background-color: rgba(242, 97, 34, 0.2); }
      100% { background-color: transparent; }
    }

    .highlight-flash {
      animation: highlightFlash 1.5s ease-out;
    }

    /* ── Code toggle for demos ────────────────────────────────────── */

    .code-toggle {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.3rem 0.625rem;
      font-size: 0.6875rem;
      font-weight: 600;
      font-family: inherit;
      color: var(--muted-foreground);
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      margin-left: 0.75rem;
      transition: color 0.15s, border-color 0.15s;
    }

    .code-toggle:hover {
      color: var(--foreground);
      border-color: var(--muted-foreground);
    }

    .code-toggle svg {
      width: 12px;
      height: 12px;
    }

    .demo-code {
      display: none;
      margin-top: 0.75rem;
    }

    .demo-code.visible {
      display: block;
    }

    .demo-code pre {
      margin: 0;
      font-size: 0.75rem;
      line-height: 1.5;
    }

    /* ── Hamburger button (hidden on desktop) ──────────────────────── */

    .menu-toggle {
      display: none;
    }

    /* ── Sidebar backdrop (mobile only) ────────────────────────────── */

    .sidebar-backdrop {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      z-index: 19;
    }

    .sidebar-backdrop.visible {
      display: block;
    }

    /* ── Mobile responsive ─────────────────────────────────────────── */

    @media (max-width: 768px) {
      /* Layout: single column */
      .app {
        grid-template-columns: 1fr;
      }

      /* Hamburger visible on mobile */
      .menu-toggle {
        display: inline-flex;
      }

      /* Sidebar: off-canvas overlay */
      .sidebar {
        position: fixed;
        top: 56px;
        left: 0;
        bottom: 0;
        width: 260px;
        z-index: 20;
        transform: translateX(-100%);
        transition: transform 0.25s ease;
        box-shadow: none;
        overflow-y: auto;
      }

      .sidebar.open {
        transform: translateX(0);
        box-shadow: var(--shadow-lg);
      }

      /* Main content: reduce padding */
      .main {
        padding: 1.25rem 1rem;
      }

      /* Typography: scale down */
      .page-title {
        font-size: 1.25rem;
      }

      .page-subtitle {
        font-size: 0.8125rem;
        margin-bottom: 1.25rem;
      }

      /* Cards grid: smaller min for narrow screens */
      .cards-grid {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      /* Stats bar: stack on small screens */
      .stats-bar {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 0.75rem;
      }

      /* Reference tables: horizontal scroll */
      .ref-table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Code blocks: ensure horizontal scroll */
      pre[class*="language-"] {
        max-width: calc(100vw - 2rem);
        overflow-x: auto;
      }

      /* Demo row: wrap on mobile */
      .demo-row {
        flex-wrap: wrap;
      }

      .demo-target {
        font-size: 0.75rem;
        padding: 0.5rem 0.75rem;
      }

      /* Demo tabs: scrollable if many */
      .demo-tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Install bar: stack */
      .install-bar {
        flex-direction: column;
        align-items: stretch;
      }

      .install-bar .cmd {
        font-size: 0.75rem;
      }

      /* Step list: tighter on mobile */
      .step {
        padding-left: 2rem;
      }

      /* Search bars */
      .search-bar input,
      .search-bar-wrap input {
        font-size: 0.8125rem;
      }

      /* Playground: already handled, but tighten padding */
      .playground-controls {
        padding: 1rem;
      }

      .playground-control label {
        min-width: 120px;
        font-size: 0.6875rem;
      }

      /* Sidebar footer: hide on mobile to save space */
      .sidebar-footer {
        display: none;
      }
    }

    /* ── Extra-small screens ───────────────────────────────────────── */

    @media (max-width: 400px) {
      .header {
        padding: 0 0.75rem;
      }

      .header-actions {
        gap: 0.25rem;
      }

      .app-name {
        font-size: 0.8125rem;
      }

      .main {
        padding: 1rem 0.75rem;
      }

      .stats-bar {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- ── Header ───────────────────────────────────────────────── -->
    <header class="header">
      <div class="header-left">
        <button class="icon-btn menu-toggle" id="btn-menu" title="Toggle menu" aria-label="Toggle navigation menu">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
          </svg>
        </button>
        <div class="logo">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" stroke="none">
            <path d="M12 2c-.6 3.6-3 5.4-3.6 9-.3 1.8.3 3.6 1.5 4.8-.6-2.4.6-4.2 2.1-6-.3 3 .6 5.4 2.4 7.2.6-1.2.9-2.7.6-4.2 1.2 1.8 2.1 3.6 1.8 6 1.2-1.2 1.8-3 1.5-4.8-.6-3.6-3.3-8.4-6.3-12z"/>
          </svg>
        </div>
        <span class="app-name">Torchlit</span>
        <span class="badge primary">docs</span>
      </div>
      <div class="header-actions">
        <button class="icon-btn" id="btn-help" data-tour-id="header-help" title="Contextual help">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
        </button>
        <button class="icon-btn" id="btn-theme" data-tour-id="header-theme" title="Toggle theme">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        <button class="icon-btn" id="btn-reset" title="Reset tours (re-trigger onboarding)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- ── Sidebar ──────────────────────────────────────────────── -->
    <nav class="sidebar">
      <div class="sidebar-label">Documentation</div>

      <button class="nav-item active" data-page="overview" data-tour-id="nav-overview">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        Overview
      </button>

      <button class="nav-item" data-page="guide" data-tour-id="nav-guide">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
        Getting Started
      </button>

      <button class="nav-item" data-page="recipes" data-tour-id="nav-recipes">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 3h6"></path>
          <path d="M10 3v4.4a1 1 0 0 1-.2.6L4 16a2 2 0 0 0 1.7 3h12.6a2 2 0 0 0 1.7-3l-5.8-8a1 1 0 0 1-.2-.6V3"></path>
        </svg>
        Recipes
      </button>

      <button class="nav-item" data-page="api" data-tour-id="nav-api">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="16 18 22 12 16 6"></polyline>
          <polyline points="8 6 2 12 8 18"></polyline>
        </svg>
        API Reference
      </button>

      <button class="nav-item" data-page="styling" data-tour-id="nav-styling">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 2a10 10 0 0 0 0 20 2 2 0 0 0 2-2v-1a2 2 0 0 1 2-2h1a2 2 0 0 0 2-2 10 10 0 0 0-7-13z"></path>
          <circle cx="8" cy="12" r="1"></circle>
          <circle cx="12" cy="8" r="1"></circle>
          <circle cx="16" cy="12" r="1"></circle>
        </svg>
        Styling
      </button>

      <div class="sidebar-spacer"></div>

      <div class="sidebar-footer">
        <div class="sidebar-footer-text">
          Powered by <code>torchlit</code><br />
          Shadow DOM aware tours
        </div>
      </div>
    </nav>
    <div class="sidebar-backdrop" id="sidebar-backdrop"></div>

    <!-- ── Main content ─────────────────────────────────────────── -->
    <main class="main" data-tour-id="main-content">

      <!-- ════════════════════════════════════════════════════════════
           Overview page
           ════════════════════════════════════════════════════════════ -->
      <div class="page active" id="page-overview">
        <h1 class="page-title">Torchlit</h1>
        <p class="page-subtitle">
          Shadow DOM-aware guided tours for any web framework.
          Lightweight, framework-agnostic, and built on <strong>Lit</strong> web components.
        </p>

        <div class="install-cmd">
          <span class="prompt">$</span>
          <span class="cmd">npm install torchlit lit</span>
          <button class="copy-btn" onclick="navigator.clipboard.writeText('npm install torchlit lit').then(()=>{this.textContent='Copied!';setTimeout(()=>this.textContent='Copy',1500)})">Copy</button>
        </div>

        <div class="stats-bar" data-tour-id="overview-stats">
          <div class="stat-card">
            <div class="stat-label">Bundle size</div>
            <div class="stat-value">~9 KB</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Dependencies</div>
            <div class="stat-value">Lit only</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Frameworks</div>
            <div class="stat-value">Any</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Shadow DOM</div>
            <div class="stat-value">Yes</div>
          </div>
        </div>

        <div class="cards-grid" data-tour-id="overview-features">
          <div class="card">
            <div class="card-icon blue">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            </div>
            <div class="card-title">Shadow DOM Traversal</div>
            <div class="card-desc">Finds tour targets inside shadow roots — something Shepherd.js and Intro.js can't do. Uses <code>deepQuery</code> to traverse any depth.</div>
          </div>
          <div class="card">
            <div class="card-icon green">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
            </div>
            <div class="card-title">Framework Agnostic</div>
            <div class="card-desc">Web Components work in React, Vue, Angular, Svelte, or vanilla JS — zero adapters needed.</div>
          </div>
          <div class="card">
            <div class="card-icon amber">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5"></path><path d="M2 12l10 5 10-5"></path></svg>
            </div>
            <div class="card-title">CSS Custom Properties</div>
            <div class="card-desc">Theme with CSS variables. Dark mode, brand colors — the overlay adapts automatically.</div>
          </div>
          <div class="card">
            <div class="card-icon rose">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
            </div>
            <div class="card-title">Tiny Footprint</div>
            <div class="card-desc">~9 KB gzipped (with Lit peer). Compare to Shepherd (~50 KB with Popper).</div>
          </div>
          <div class="card">
            <div class="card-icon green">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
            </div>
            <div class="card-title">Accessible by Default</div>
            <div class="card-desc">ARIA <code>role="dialog"</code>, focus trapping, keyboard navigation, and <code>aria-live</code> announcements for screen readers.</div>
          </div>
          <div class="card">
            <div class="card-icon blue">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline></svg>
            </div>
            <div class="card-title">Smart Auto-Positioning</div>
            <div class="card-desc">Tooltips flip automatically when the preferred side clips the viewport. Arrow tracks the target center.</div>
          </div>
          <div class="card">
            <div class="card-icon amber">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
            </div>
            <div class="card-title">MutationObserver Targets</div>
            <div class="card-desc">No fixed timeouts — watches the DOM for lazy-loaded elements to appear. Reliable in SPAs with async routes.</div>
          </div>
        </div>

        <!-- Quick Start snippet -->
        <div class="doc-section">
          <h2 class="section-title">Quick Start</h2>
          <p class="doc-text">
            Three steps: create a service, register a tour, mount the overlay.
          </p>
          <pre><code class="language-typescript">import { createTourService } from 'torchlit';
import 'torchlit/overlay';

const tours = createTourService();

tours.register({
  id: 'welcome',
  name: 'Welcome',
  trigger: 'first-visit',
  steps: [
    { target: 'sidebar', title: 'Navigation', message: 'Use the sidebar to get around.', placement: 'right' },
    { target: 'search',  title: 'Search',     message: 'Find anything instantly.',       placement: 'bottom' },
  ],
});

const overlay = document.querySelector('torchlit-overlay');
overlay.service = tours;

if (tours.shouldAutoStart('welcome')) {
  tours.start('welcome');
}</code></pre>
        </div>
      </div>

      <!-- ════════════════════════════════════════════════════════════
           Getting Started page
           ════════════════════════════════════════════════════════════ -->
      <div class="page" id="page-guide">
        <h1 class="page-title">Getting Started</h1>
        <p class="page-subtitle">
          A step-by-step guide to adding guided tours to your application.
        </p>

        <div class="search-bar" data-tour-id="guide-search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input type="text" placeholder="Search docs…" />
        </div>

        <!-- Step 1 -->
        <div class="step">
          <div class="step-number">1</div>
          <div class="step-title">Install</div>
          <p class="doc-text">Add Torchlit and its Lit peer dependency.</p>
          <pre><code class="language-bash">npm install torchlit lit</code></pre>
        </div>

        <!-- Step 2 -->
        <div class="step">
          <div class="step-number">2</div>
          <div class="step-title">Import &amp; Create a Service</div>
          <p class="doc-text">
            The <code>TourService</code> manages all tour state — registration, navigation, and persistence.
            The overlay is a separate import so you can tree-shake if needed.
          </p>
          <pre><code class="language-typescript">import { createTourService } from 'torchlit';
import 'torchlit/overlay';  // registers &lt;torchlit-overlay&gt;

const tours = createTourService({
  storageKey: 'my-app-tours',   // localStorage key for state
  spotlightPadding: 12,         // px around highlighted element
});</code></pre>
        </div>

        <!-- Step 3 -->
        <div class="step">
          <div class="step-number">3</div>
          <div class="step-title">Mark Your Targets</div>
          <p class="doc-text">
            Add <code>data-tour-id</code> attributes to any element you want to spotlight.
            Works in light DOM and shadow DOM — Torchlit traverses shadow roots automatically.
          </p>
          <pre><code class="language-html">&lt;nav data-tour-id="sidebar"&gt;…&lt;/nav&gt;
&lt;input data-tour-id="search" placeholder="Search…" /&gt;
&lt;my-web-component&gt;
  &lt;!-- targets inside shadow roots work too --&gt;
&lt;/my-web-component&gt;</code></pre>
        </div>

        <!-- Step 4 -->
        <div class="step">
          <div class="step-number">4</div>
          <div class="step-title">Define a Tour</div>
          <p class="doc-text">
            A tour is an object with an <code>id</code>, a <code>trigger</code>, and an array of <code>steps</code>.
            Each step targets an element and shows a tooltip.
          </p>
          <pre><code class="language-typescript">tours.register({
  id: 'onboarding',
  name: 'Welcome Tour',
  trigger: 'first-visit',   // or 'manual'
  steps: [
    {
      target: '_none_',        // centered card, no spotlight
      title: 'Welcome!',
      message: 'Let us show you around.',
      placement: 'bottom',
    },
    {
      target: 'sidebar',
      title: 'Navigation',
      message: 'Browse sections from the sidebar.',
      placement: 'right',
    },
    {
      target: 'search',
      title: 'Search',
      message: 'Find anything with the search bar.',
      placement: 'bottom',
    },
  ],
  onComplete: () =&gt; console.log('Done!'),
  onSkip: () =&gt; console.log('Skipped'),
});</code></pre>
        </div>

        <!-- Step 5 -->
        <div class="step">
          <div class="step-number">5</div>
          <div class="step-title">Mount the Overlay &amp; Start</div>
          <p class="doc-text">
            Drop the <code>&lt;torchlit-overlay&gt;</code> element anywhere in your page.
            Assign the service and start the tour.
          </p>
          <pre><code class="language-html">&lt;torchlit-overlay&gt;&lt;/torchlit-overlay&gt;

&lt;script type="module"&gt;
  const overlay = document.querySelector('torchlit-overlay');
  overlay.service = tours;

  // Auto-start on first visit
  if (tours.shouldAutoStart('onboarding')) {
    tours.start('onboarding');
  }
&lt;/script&gt;</code></pre>
        </div>

        <!-- Advanced: Route Changes -->
        <div class="doc-section">
          <h2 class="section-title">Route Changes</h2>
          <p class="doc-text">
            Tours can span multiple views. Add a <code>route</code> property to a step and use
            <code>beforeShow</code> to navigate. The overlay emits a <code>tour-route-change</code> event
            so your app can react.
          </p>
          <pre><code class="language-typescript">// Step that switches pages
{
  target: 'dashboard-chart',
  title: 'Dashboard',
  message: 'Check out the live charts.',
  placement: 'top',
  route: 'dashboard',
  beforeShow: () =&gt; router.push('/dashboard'),
}

// Listen for route changes from the overlay
overlay.addEventListener('tour-route-change', (e) =&gt; {
  router.push(e.detail.route);
});</code></pre>
        </div>

        <!-- Advanced: Contextual Help -->
        <div class="doc-section">
          <h2 class="section-title">Contextual Help Pattern</h2>
          <p class="doc-text">
            Register short <code>manual</code> tours for each page, then start the right one based on the current route.
            This is exactly what this docs site does — click the <strong>?</strong> button to try it.
          </p>
          <pre><code class="language-typescript">const helpMap = { home: 'home-help', settings: 'settings-help' };

helpButton.addEventListener('click', () =&gt; {
  const tourId = helpMap[currentPage];
  if (tourId) tours.start(tourId);
});</code></pre>
        </div>

      </div>

      <!-- ════════════════════════════════════════════════════════════
           Recipes page
           ════════════════════════════════════════════════════════════ -->
      <div class="page" id="page-recipes">
        <h1 class="page-title">Recipes</h1>
        <p class="page-subtitle">
          Ready-to-copy patterns for common use cases and framework integrations.
        </p>

        <div class="search-bar" data-tour-id="recipes-search">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
          <input type="text" id="recipes-search-input" placeholder="Search recipes…" />
        </div>

        <div class="api-pills" data-tour-id="recipes-pills">
          <button class="api-pill" onclick="document.getElementById('recipe-frameworks').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
            Frameworks
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-spa').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg>
            SPA Tours
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-mpa').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
            Multi-Page
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-kiosk').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            Kiosk Mode
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-shadow').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            Shadow DOM
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-contextual').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
            Contextual Help
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-rich').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
            Rich Content
          </button>
          <button class="api-pill" onclick="document.getElementById('recipe-storage').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>
            Custom Storage
          </button>
        </div>

        <!-- ── Framework Integrations ──────────────────────────────── -->

        <div class="doc-section" id="recipe-frameworks" data-tour-id="recipes-frameworks">
          <h2 class="section-title">Framework Integration</h2>
          <p class="doc-text">
            Torchlit is a web component — it works with any framework. Here's how to wire it into the most popular ones.
          </p>

          <div class="recipe-sub">
          <h3 class="subsection-title">React</h3>
          <p class="doc-text">
            Create the service once in a hook or context provider.
            Use a <code>ref</code> for the overlay and assign <code>.service</code> in <code>useEffect</code>.
          </p>
          <pre><code class="language-typescript">import { useEffect, useRef } from 'react';
import { createTourService } from 'torchlit';
import 'torchlit/overlay';

const tours = createTourService({ storageKey: 'my-app-tours' });

tours.register({
  id: 'welcome',
  name: 'Welcome',
  trigger: 'first-visit',
  steps: [
    { target: 'sidebar', title: 'Navigation', message: 'Browse from here.', placement: 'right' },
    { target: 'search',  title: 'Search',     message: 'Find anything.',    placement: 'bottom' },
  ],
});

export function App() {
  const overlayRef = useRef&lt;HTMLElement&gt;(null);

  useEffect(() => {
    const el = overlayRef.current;
    if (el) el.service = tours;

    if (tours.shouldAutoStart('welcome')) {
      setTimeout(() => tours.start('welcome'), 500);
    }
  }, []);

  return (
    &lt;&gt;
      {/* your app JSX */}
      &lt;torchlit-overlay ref={overlayRef} /&gt;
    &lt;/&gt;
  );
}</code></pre>
          <blockquote class="doc-text" style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--muted-foreground);">
            <strong>Tip:</strong> For shared access across components, expose <code>tours</code> via React Context or a module-level singleton.
          </blockquote>
          </div>

          <div class="recipe-sub">
          <h3 class="subsection-title">Vue 3</h3>
          <p class="doc-text">
            Use a composable or create the service at the app level. Assign via a template ref in <code>onMounted</code>.
          </p>
          <pre><code class="language-typescript">&lt;script setup lang="ts"&gt;
import { ref, onMounted } from 'vue';
import { createTourService } from 'torchlit';
import 'torchlit/overlay';

const tours = createTourService({ storageKey: 'my-app-tours' });
const overlayRef = ref&lt;HTMLElement | null&gt;(null);

tours.register({
  id: 'welcome',
  name: 'Welcome',
  trigger: 'first-visit',
  steps: [
    { target: 'sidebar', title: 'Navigation', message: 'Browse from here.', placement: 'right' },
    { target: 'search',  title: 'Search',     message: 'Find anything.',    placement: 'bottom' },
  ],
});

onMounted(() => {
  if (overlayRef.value) overlayRef.value.service = tours;

  if (tours.shouldAutoStart('welcome')) {
    setTimeout(() => tours.start('welcome'), 500);
  }
});
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- your app template --&gt;
  &lt;torchlit-overlay ref="overlayRef" /&gt;
&lt;/template&gt;</code></pre>
          </div>

          <div class="recipe-sub">
          <h3 class="subsection-title">Svelte</h3>
          <p class="doc-text">
            Bind the overlay element with <code>bind:this</code> and wire it up in <code>onMount</code>.
          </p>
          <pre><code class="language-typescript">&lt;script&gt;
  import { onMount } from 'svelte';
  import { createTourService } from 'torchlit';
  import 'torchlit/overlay';

  const tours = createTourService({ storageKey: 'my-app-tours' });
  let overlay;

  tours.register({
    id: 'welcome',
    name: 'Welcome',
    trigger: 'first-visit',
    steps: [
      { target: 'sidebar', title: 'Navigation', message: 'Browse from here.', placement: 'right' },
      { target: 'search',  title: 'Search',     message: 'Find anything.',    placement: 'bottom' },
    ],
  });

  onMount(() => {
    overlay.service = tours;
    if (tours.shouldAutoStart('welcome')) {
      setTimeout(() => tours.start('welcome'), 500);
    }
  });
&lt;/script&gt;

&lt;!-- your app markup --&gt;
&lt;torchlit-overlay bind:this={overlay} /&gt;</code></pre>
          </div>

          <div class="recipe-sub">
          <h3 class="subsection-title">Plain JS / TS</h3>
          <p class="doc-text">
            No framework needed — just a <code>&lt;script type="module"&gt;</code> tag.
          </p>
          <pre><code class="language-html">&lt;torchlit-overlay&gt;&lt;/torchlit-overlay&gt;

&lt;script type="module"&gt;
  import { createTourService, TorchlitOverlay } from 'torchlit';

  if (!customElements.get('torchlit-overlay')) {
    customElements.define('torchlit-overlay', TorchlitOverlay);
  }

  const tours = createTourService();
  const overlay = document.querySelector('torchlit-overlay');
  overlay.service = tours;

  tours.register({
    id: 'welcome', name: 'Welcome', trigger: 'first-visit',
    steps: [
      { target: 'sidebar', title: 'Navigation', message: 'Browse.', placement: 'right' },
    ],
  });

  if (tours.shouldAutoStart('welcome')) tours.start('welcome');
&lt;/script&gt;</code></pre>
          </div>
        </div>

        <!-- ── SPA Multi-View Tours ────────────────────────────────── -->

        <div class="doc-section" id="recipe-spa" data-tour-id="recipes-spa">
          <h2 class="section-title">SPA Multi-View Tours</h2>
          <p class="doc-text">
            In single-page apps, tours can span multiple views without losing state.
            Use <code>beforeShow</code> to navigate and <code>route</code> to emit a <code>tour-route-change</code> event.
          </p>
          <pre><code class="language-typescript">tours.register({
  id: 'full-tour',
  name: 'App Tour',
  trigger: 'first-visit',
  steps: [
    {
      target: 'dashboard-stats',
      title: 'Dashboard',
      message: 'Your key metrics at a glance.',
      placement: 'bottom',
      beforeShow: () => router.push('/dashboard'),
    },
    {
      target: 'analytics-chart',
      title: 'Analytics',
      message: 'The tour followed you to a new page!',
      placement: 'top',
      route: 'analytics',
      beforeShow: () => router.push('/analytics'),
    },
    {
      target: 'settings-panel',
      title: 'Settings',
      message: 'Configure your preferences here.',
      placement: 'left',
      route: 'settings',
      beforeShow: () => router.push('/settings'),
    },
  ],
});

// Listen for route hints from the overlay
overlay.addEventListener('tour-route-change', (e) => {
  router.push(e.detail.route);
});</code></pre>
          <blockquote class="doc-text" style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--muted-foreground);">
            <strong>Tip:</strong> Add <code>beforeShow</code> to <em>every</em> step that needs a specific view — not just forward transitions. This ensures backward navigation (Back button) also lands on the correct page.
          </blockquote>
        </div>

        <!-- ── Multi-Page (MPA) Apps ───────────────────────────────── -->

        <div class="doc-section" id="recipe-mpa" data-tour-id="recipes-mpa">
          <h2 class="section-title">Multi-Page (MPA) Apps</h2>
          <p class="doc-text">
            For traditional multi-page apps where each URL is a full page load, Torchlit persists
            completed/dismissed state to <code>localStorage</code>. Register per-page tours on each page
            and use <code>shouldAutoStart</code> to resume.
          </p>
          <pre><code class="language-typescript">// ── dashboard.html ──────────────────────────
import { createTourService } from 'torchlit';
import 'torchlit/overlay';

const tours = createTourService({ storageKey: 'my-app-tours' });

tours.register({
  id: 'dashboard-intro',
  name: 'Dashboard Intro',
  trigger: 'first-visit',
  steps: [
    { target: 'stats',   title: 'Stats',   message: 'Your key metrics.',   placement: 'bottom' },
    { target: 'actions', title: 'Actions',  message: 'Quick actions here.', placement: 'right' },
  ],
  onComplete: () => {
    // Guide user to the next page
    window.location.href = '/analytics';
  },
});

const overlay = document.querySelector('torchlit-overlay');
overlay.service = tours;

if (tours.shouldAutoStart('dashboard-intro')) {
  tours.start('dashboard-intro');
}</code></pre>
          <pre><code class="language-typescript">// ── analytics.html ──────────────────────────
// Same storageKey — state carries over!
const tours = createTourService({ storageKey: 'my-app-tours' });

tours.register({
  id: 'analytics-intro',
  name: 'Analytics Intro',
  trigger: 'first-visit',
  steps: [
    { target: 'chart', title: 'Charts', message: 'Your analytics.', placement: 'top' },
  ],
});

// ...</code></pre>
          <blockquote class="doc-text" style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--muted-foreground);">
            <strong>Key:</strong> Use the same <code>storageKey</code> across pages so completed/dismissed state is shared. Each page registers only its own tour.
          </blockquote>
        </div>

        <!-- ── Kiosk / Demo Mode ───────────────────────────────────── -->

        <div class="doc-section" id="recipe-kiosk" data-tour-id="recipes-kiosk">
          <h2 class="section-title">Kiosk / Demo Mode</h2>
          <p class="doc-text">
            Combine <code>loop: true</code> with <code>autoAdvance</code> for hands-free, self-running tours.
            Perfect for expo booths, product demos, and digital signage.
          </p>
          <pre><code class="language-typescript">tours.register({
  id: 'kiosk',
  name: 'Product Demo',
  trigger: 'manual',
  loop: true,  // restarts from step 0 after the last step
  steps: [
    {
      target: 'feature-1',
      title: 'Smart Search',
      message: 'Find anything in milliseconds.',
      placement: 'bottom',
      autoAdvance: 4000,  // advance after 4 seconds
    },
    {
      target: 'feature-2',
      title: 'Real-Time Sync',
      message: 'Changes appear instantly across devices.',
      placement: 'right',
      autoAdvance: 4000,
    },
    {
      target: 'feature-3',
      title: 'Team Collaboration',
      message: 'Work together seamlessly.',
      placement: 'left',
      autoAdvance: 4000,
    },
  ],
});

// Start the loop
tours.start('kiosk');</code></pre>
          <blockquote class="doc-text" style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--muted-foreground);">
            <strong>Note:</strong> Users can still exit with <kbd>Escape</kbd> or the Skip button. A progress bar renders automatically at the bottom of each tooltip.
          </blockquote>
        </div>

        <!-- ── Shadow DOM Targets ──────────────────────────────────── -->

        <div class="doc-section" id="recipe-shadow" data-tour-id="recipes-shadow">
          <h2 class="section-title">Shadow DOM Targets</h2>
          <p class="doc-text">
            Torchlit's <code>deepQuery</code> utility traverses into shadow roots automatically.
            Just add <code>data-tour-id</code> to any element — even deeply nested inside web components.
          </p>
          <pre><code class="language-html">&lt;!-- Your custom element --&gt;
&lt;my-sidebar&gt;
  #shadow-root
    &lt;nav&gt;
      &lt;button data-tour-id="nav-home"&gt;Home&lt;/button&gt;
      &lt;my-dropdown&gt;
        #shadow-root
          &lt;div data-tour-id="nav-settings"&gt;Settings&lt;/div&gt;
      &lt;/my-dropdown&gt;
    &lt;/nav&gt;
&lt;/my-sidebar&gt;</code></pre>
          <pre><code class="language-typescript">// Torchlit finds both targets — no extra configuration
tours.register({
  id: 'nav-tour',
  name: 'Navigation',
  trigger: 'manual',
  steps: [
    { target: 'nav-home',     title: 'Home',     message: 'Go to the dashboard.', placement: 'right' },
    { target: 'nav-settings', title: 'Settings',  message: 'Found inside nested shadow DOM!', placement: 'right' },
  ],
});</code></pre>
          <p class="doc-text">
            You can also use a custom attribute instead of <code>data-tour-id</code>:
          </p>
          <pre><code class="language-typescript">const tours = createTourService({
  targetAttribute: 'data-onboard',  // matches [data-onboard="..."]
});</code></pre>
        </div>

        <!-- ── Contextual Help ─────────────────────────────────────── -->

        <div class="doc-section" id="recipe-contextual" data-tour-id="recipes-contextual">
          <h2 class="section-title">Contextual Help</h2>
          <p class="doc-text">
            Register short <code>manual</code> tours per section, then wire a help button to start the right one based on the current view.
            This is the exact pattern used on this docs site.
          </p>
          <pre><code class="language-typescript">// Register per-section help tours
tours.register([
  {
    id: 'dashboard-help',
    name: 'Dashboard Help',
    trigger: 'manual',
    steps: [
      { target: 'stats',   title: 'Stats',   message: 'Your daily metrics.',        placement: 'bottom' },
      { target: 'actions', title: 'Actions',  message: 'Quick actions are here.',    placement: 'right' },
    ],
  },
  {
    id: 'settings-help',
    name: 'Settings Help',
    trigger: 'manual',
    steps: [
      { target: 'profile', title: 'Profile', message: 'Update your info.',          placement: 'bottom' },
      { target: 'prefs',   title: 'Prefs',   message: 'Customize your experience.', placement: 'right' },
    ],
  },
]);

// Map views to their help tour
const helpMap = {
  dashboard: 'dashboard-help',
  settings:  'settings-help',
};

document.getElementById('btn-help').addEventListener('click', () => {
  const currentView = getCurrentView(); // your app logic
  const tourId = helpMap[currentView];
  if (tourId) tours.start(tourId);
});</code></pre>
        </div>

        <!-- ── Rich Content in Tooltips ────────────────────────────── -->

        <div class="doc-section" id="recipe-rich" data-tour-id="recipes-rich">
          <h2 class="section-title">Rich Content in Tooltips</h2>
          <p class="doc-text">
            Step messages accept Lit <code>html</code> tagged templates for rich HTML — bold, links, keyboard shortcuts, lists, and more.
          </p>
          <pre><code class="language-typescript">import { html } from 'lit';

tours.register({
  id: 'rich-tour',
  name: 'Rich Content',
  trigger: 'manual',
  steps: [
    {
      target: 'editor',
      title: 'Keyboard Shortcuts',
      message: html`
        &lt;p&gt;Press &lt;kbd&gt;Ctrl+S&lt;/kbd&gt; to save,
        &lt;kbd&gt;Ctrl+Z&lt;/kbd&gt; to undo.&lt;/p&gt;
        &lt;p&gt;See &lt;a href="/docs/shortcuts"
          style="color: var(--primary)"&gt;all shortcuts&lt;/a&gt;.&lt;/p&gt;
      `,
      placement: 'bottom',
    },
    {
      target: 'toolbar',
      title: 'Formatting',
      message: html`
        &lt;ul style="margin: 0.5rem 0; padding-left: 1.25rem;"&gt;
          &lt;li&gt;&lt;strong&gt;Bold&lt;/strong&gt; — Ctrl+B&lt;/li&gt;
          &lt;li&gt;&lt;em&gt;Italic&lt;/em&gt; — Ctrl+I&lt;/li&gt;
          &lt;li&gt;&lt;code&gt;Code&lt;/code&gt; — Ctrl+\`&lt;/li&gt;
        &lt;/ul&gt;
      `,
      placement: 'bottom',
    },
  ],
});</code></pre>
        </div>

        <!-- ── Custom Storage Adapter ──────────────────────────────── -->

        <div class="doc-section" id="recipe-storage" data-tour-id="recipes-storage">
          <h2 class="section-title">Custom Storage Adapter</h2>
          <p class="doc-text">
            By default Torchlit persists state to <code>localStorage</code>. You can swap in
            <code>sessionStorage</code>, an API backend, or any object with <code>getItem</code> / <code>setItem</code>.
          </p>

          <div class="recipe-sub">
          <h3 class="subsection-title">sessionStorage</h3>
          <p class="doc-text">
            Show tours once per browser session instead of permanently:
          </p>
          <pre><code class="language-typescript">const tours = createTourService({
  storage: sessionStorage,
});</code></pre>
          </div>

          <div class="recipe-sub">
          <h3 class="subsection-title">API-Backed Persistence</h3>
          <p class="doc-text">
            Sync tour state to your server so it follows the user across devices:
          </p>
          <pre><code class="language-typescript">const tours = createTourService({
  storage: {
    getItem(key) {
      // Return cached value synchronously;
      // hydrate from API on app startup
      return localStorage.getItem(key);
    },
    setItem(key, value) {
      localStorage.setItem(key, value);
      // Fire-and-forget API sync
      fetch('/api/tour-state', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ key, value }),
      });
    },
  },
});</code></pre>
          <blockquote class="doc-text" style="border-left: 3px solid var(--primary); padding-left: 1rem; margin: 1rem 0; color: var(--muted-foreground);">
            <strong>Note:</strong> The storage adapter must be synchronous (<code>getItem</code> returns a string or null).
            Use a local cache with async background sync as shown above.
          </blockquote>
          </div>
        </div>

      </div>

      <!-- ════════════════════════════════════════════════════════════
           API Reference page
           ════════════════════════════════════════════════════════════ -->
      <div class="page" id="page-api">
        <h1 class="page-title">API Reference</h1>
        <p class="page-subtitle">Complete reference for all exports, methods, types, and events.</p>

        <div class="search-bar-wrap" data-tour-id="api-search">
          <div class="search-bar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" placeholder="Jump to method, property, or type…" id="api-search-input" autocomplete="off" />
          </div>
          <div class="api-search-results" id="api-search-results"></div>
        </div>

        <div class="api-pills" data-tour-id="api-service">
          <button class="api-pill" onclick="document.getElementById('ref-service').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            TourService
          </button>
          <button class="api-pill" data-tour-id="api-overlay" onclick="document.getElementById('ref-overlay').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="9" y1="21" x2="9" y2="9"></line></svg>
            Overlay
          </button>
          <button class="api-pill" onclick="document.getElementById('ref-types').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
            Types
          </button>
          <button class="api-pill" onclick="document.getElementById('ref-deepquery').scrollIntoView({behavior:'smooth'})">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            deepQuery
          </button>
        </div>

        <!-- createTourService -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-service">createTourService(config?)</h2>
          <p class="doc-text">
            Factory function that returns a new <code>TourService</code> instance.
            Import from <code>torchlit</code> or <code>torchlit/service</code> (the latter skips the overlay for service-only use).
          </p>
          <pre><code class="language-typescript">import { createTourService } from 'torchlit';

const tours = createTourService({
  storageKey: 'my-app-tours',
  spotlightPadding: 12,
});</code></pre>

          <h3 class="subsection-title">TourConfig</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>storageKey</code></td><td><code>string</code></td><td><code>'torchlit-state'</code></td><td>localStorage key for persisting completed/dismissed state</td></tr>
              <tr><td><code>storage</code></td><td><code>StorageAdapter</code></td><td><code>localStorage</code></td><td>Custom storage backend (must implement <code>getItem</code> / <code>setItem</code>)</td></tr>
              <tr><td><code>targetAttribute</code></td><td><code>string</code></td><td><code>'data-tour-id'</code></td><td>The DOM attribute used to find tour targets</td></tr>
              <tr><td><code>spotlightPadding</code></td><td><code>number</code></td><td><code>10</code></td><td>Pixels of padding around the spotlight cutout</td></tr>
            </tbody>
          </table>
        </div>

        <!-- TourService methods -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-methods">TourService Methods</h2>

          <h3 class="subsection-title">Registration</h3>
          <table class="ref-table">
            <thead><tr><th>Method</th><th>Signature</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>register</code></td><td class="sig">register(tour: TourDefinition): void</td><td>Register a single tour</td></tr>
              <tr><td><code>register</code></td><td class="sig">register(tours: TourDefinition[]): void</td><td>Register multiple tours at once</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Tour Control</h3>
          <table class="ref-table">
            <thead><tr><th>Method</th><th>Signature</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>start</code></td><td class="sig">start(tourId: string): void</td><td>Start a tour by ID. No-op if the tour doesn't exist or has no steps.</td></tr>
              <tr><td><code>nextStep</code></td><td class="sig">nextStep(): void</td><td>Advance to the next step. Completes the tour if on the last step.</td></tr>
              <tr><td><code>prevStep</code></td><td class="sig">prevStep(): void</td><td>Go back to the previous step. No-op if on step 0.</td></tr>
              <tr><td><code>skipTour</code></td><td class="sig">skipTour(): void</td><td>Dismiss the active tour and persist it as "dismissed".</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Queries</h3>
          <table class="ref-table">
            <thead><tr><th>Method</th><th>Signature</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>isActive</code></td><td class="sig">isActive(): boolean</td><td>Whether any tour is currently running</td></tr>
              <tr><td><code>shouldAutoStart</code></td><td class="sig">shouldAutoStart(tourId: string): boolean</td><td>Returns <code>true</code> if the tour has <code>trigger: 'first-visit'</code> and hasn't been completed or dismissed</td></tr>
              <tr><td><code>getTour</code></td><td class="sig">getTour(id: string): TourDefinition | undefined</td><td>Look up a registered tour by ID</td></tr>
              <tr><td><code>getAvailableTours</code></td><td class="sig">getAvailableTours(): TourDefinition[]</td><td>All registered tours</td></tr>
              <tr><td><code>getSnapshot</code></td><td class="sig">getSnapshot(): TourSnapshot | null</td><td>Current step state for the overlay (null if no tour is active)</td></tr>
              <tr><td><code>findTarget</code></td><td class="sig">findTarget(targetId: string): Element | null</td><td>Find an element by <code>data-tour-id</code> (traverses shadow DOM)</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Subscription</h3>
          <table class="ref-table">
            <thead><tr><th>Method</th><th>Signature</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>subscribe</code></td><td class="sig">subscribe(listener: TourListener): () =&gt; void</td><td>Subscribe to state changes. Returns an unsubscribe function. The overlay uses this internally.</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Reset</h3>
          <table class="ref-table">
            <thead><tr><th>Method</th><th>Signature</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>resetAll</code></td><td class="sig">resetAll(): void</td><td>Clear all persisted state, stop any active tour, and unregister all tours</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Properties</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>targetAttribute</code></td><td><code>readonly string</code></td><td>The data attribute used for target lookup. Set via <code>TourConfig</code>.</td></tr>
              <tr><td><code>spotlightPadding</code></td><td><code>readonly number</code></td><td>Padding in pixels around the spotlight. Set via <code>TourConfig</code>.</td></tr>
            </tbody>
          </table>
        </div>

        <!-- TorchlitOverlay -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-overlay">&lt;torchlit-overlay&gt;</h2>
          <p class="doc-text">
            The web component that renders the backdrop, spotlight, and tooltip. Import from
            <code>torchlit</code> or <code>torchlit/overlay</code>.
          </p>

          <h3 class="subsection-title">Properties</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>service</code></td><td><code>TourService</code></td><td>Required. The tour service instance that drives this overlay.</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Events</h3>
          <table class="ref-table">
            <thead><tr><th>Event</th><th>Detail</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>tour-route-change</code></td><td><code>{ route: string }</code></td><td>Fired when a step has a <code>route</code> property. The host application should handle navigation.</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">Keyboard Shortcuts</h3>
          <table class="ref-table">
            <thead><tr><th>Key</th><th>Action</th></tr></thead>
            <tbody>
              <tr><td><kbd>Escape</kbd></td><td>Skip / dismiss the tour</td></tr>
              <tr><td><kbd>→</kbd> or <kbd>Enter</kbd></td><td>Next step</td></tr>
              <tr><td><kbd>←</kbd></td><td>Previous step</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">CSS Parts</h3>
          <p class="doc-text">
            Style internal elements from outside the shadow DOM with <code>::part()</code>.
          </p>
          <table class="ref-table">
            <thead><tr><th>Part</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>backdrop</code></td><td>The semi-transparent overlay behind the spotlight</td></tr>
              <tr><td><code>spotlight</code></td><td>The cutout highlight around the target element</td></tr>
              <tr><td><code>tooltip</code></td><td>The floating tooltip card with title, message, and controls</td></tr>
              <tr><td><code>center-card</code></td><td>The centered card shown for steps with <code>target: '_none_'</code></td></tr>
            </tbody>
          </table>
          <pre><code class="language-css">torchlit-overlay::part(tooltip) {
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}

torchlit-overlay::part(backdrop) {
  background: rgba(0, 0, 0, 0.6);
}</code></pre>
        </div>

        <!-- Types -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-types">Types</h2>

          <h3 class="subsection-title">TourPlacement</h3>
          <pre><code class="language-typescript">type TourPlacement = 'top' | 'bottom' | 'left' | 'right';</code></pre>

          <h3 class="subsection-title">TourStep</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>target</code></td><td><code>string</code></td><td>Yes</td><td>The <code>data-tour-id</code> value to spotlight. Use <code>'_none_'</code> for a centered card.</td></tr>
              <tr><td><code>title</code></td><td><code>string</code></td><td>Yes</td><td>Bold title in the tooltip</td></tr>
              <tr><td><code>message</code></td><td><code>string | TemplateResult</code></td><td>Yes</td><td>Body text in the tooltip. Accepts plain strings or Lit <code>html``</code> templates for rich content.</td></tr>
              <tr><td><code>placement</code></td><td><code>'top' | 'bottom' | 'left' | 'right'</code></td><td>Yes</td><td>Preferred tooltip position. Auto-flips when the viewport clips.</td></tr>
              <tr><td><code>spotlightBorderRadius</code></td><td><code>string</code></td><td>No</td><td>Override spotlight shape per step. <code>'50%'</code> for circle, <code>'9999px'</code> for pill, <code>'0'</code> for sharp.</td></tr>
              <tr><td><code>autoAdvance</code></td><td><code>number</code></td><td>No</td><td>Auto-advance after N ms. A progress bar renders at the bottom of the tooltip. Manual interaction cancels.</td></tr>
              <tr><td><code>route</code></td><td><code>string</code></td><td>No</td><td>Emits <code>tour-route-change</code> so the app can navigate before this step</td></tr>
              <tr><td><code>beforeShow</code></td><td><code>() =&gt; void | Promise&lt;void&gt;</code></td><td>No</td><td>Async hook called before the step is displayed</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">TourDefinition</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Required</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>id</code></td><td><code>string</code></td><td>Yes</td><td>Unique tour identifier</td></tr>
              <tr><td><code>name</code></td><td><code>string</code></td><td>Yes</td><td>Human-readable tour name</td></tr>
              <tr><td><code>trigger</code></td><td><code>'first-visit' | 'manual'</code></td><td>Yes</td><td><code>first-visit</code> auto-starts once, <code>manual</code> requires <code>start()</code></td></tr>
              <tr><td><code>steps</code></td><td><code>TourStep[]</code></td><td>Yes</td><td>Ordered array of steps</td></tr>
              <tr><td><code>loop</code></td><td><code>boolean</code></td><td>No</td><td>When <code>true</code>, advancing past the last step restarts at step 0 instead of completing. Combine with <code>autoAdvance</code> for kiosk / demo modes.</td></tr>
              <tr><td><code>onEndScroll</code></td><td><code>'restore' | 'top' | 'none'</code></td><td>No</td><td>Scroll behaviour on tour end. <code>'restore'</code> (default) scrolls back to the pre-tour position; <code>'top'</code> scrolls to top; <code>'none'</code> leaves scroll as-is.</td></tr>
              <tr><td><code>onComplete</code></td><td><code>() =&gt; void</code></td><td>No</td><td>Called when the user finishes the last step (not called when looping)</td></tr>
              <tr><td><code>onSkip</code></td><td><code>() =&gt; void</code></td><td>No</td><td>Called when the user dismisses the tour</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">TourSnapshot</h3>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>tourId</code></td><td><code>string</code></td><td>ID of the active tour</td></tr>
              <tr><td><code>tourName</code></td><td><code>string</code></td><td>Name of the active tour</td></tr>
              <tr><td><code>step</code></td><td><code>TourStep</code></td><td>The current step object</td></tr>
              <tr><td><code>stepIndex</code></td><td><code>number</code></td><td>Zero-based index of the current step</td></tr>
              <tr><td><code>totalSteps</code></td><td><code>number</code></td><td>Total number of steps in the tour</td></tr>
              <tr><td><code>targetRect</code></td><td><code>DOMRect | null</code></td><td>Bounding rect of the target element (null for <code>_none_</code>)</td></tr>
              <tr><td><code>targetElement</code></td><td><code>Element | null</code></td><td>The resolved DOM element (null for <code>_none_</code>)</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">TourState</h3>
          <p class="doc-text">Persisted state managed by the service. Exposed as a type for custom storage adapters.</p>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead>
            <tbody>
              <tr><td><code>completed</code></td><td><code>string[]</code></td><td>Tour IDs that the user has fully completed</td></tr>
              <tr><td><code>dismissed</code></td><td><code>string[]</code></td><td>Tour IDs that the user has skipped / dismissed</td></tr>
            </tbody>
          </table>

          <h3 class="subsection-title">StorageAdapter</h3>
          <pre><code class="language-typescript">interface StorageAdapter {
  getItem(key: string): string | null;
  setItem(key: string, value: string): void;
}</code></pre>

          <h3 class="subsection-title">TourListener</h3>
          <pre><code class="language-typescript">type TourListener = (snapshot: TourSnapshot | null) =&gt; void;</code></pre>
        </div>

        <!-- deepQuery -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-deepquery">deepQuery(selector, root?)</h2>
          <p class="doc-text">
            Finds the first element matching a CSS selector, traversing into shadow roots.
            Used internally by <code>TourService.findTarget()</code> but exported for your own use.
          </p>
          <pre><code class="language-typescript">import { deepQuery } from 'torchlit';

// Find an element inside any shadow root
const el = deepQuery('[data-tour-id="my-target"]');

// Search within a specific subtree
const scoped = deepQuery('.btn', myComponent);</code></pre>
        </div>
      </div>

      <!-- ════════════════════════════════════════════════════════════
           Styling page
           ════════════════════════════════════════════════════════════ -->
      <div class="page" id="page-styling">
        <h1 class="page-title">Styling</h1>
        <p class="page-subtitle">
          Customize the overlay with CSS custom properties, <code>::part()</code> selectors, and theme tokens.
          Toggle dark mode with the sun icon above to see it in action.
        </p>

        <!-- Interactive examples -->
        <div class="doc-section" data-tour-id="guide-demo">
          <h2 class="section-title">Interactive Examples</h2>
          <p class="doc-text">
            Click <strong>Run Demo</strong> to try each mini-tour live, then <strong>View Code</strong> to see the configuration.
          </p>

          <div class="demo-panel">
            <div class="demo-tabs">
              <button class="demo-tab active" data-demo="basic">Basic</button>
              <button class="demo-tab" data-demo="rich">Rich Content</button>
              <button class="demo-tab" data-demo="auto">Auto-Advance</button>
              <button class="demo-tab" data-demo="shapes">Shapes</button>
            </div>

            <!-- Basic demo -->
            <div class="demo-content active" id="demo-basic">
              <div class="demo-row">
                <div class="demo-target" data-tour-id="demo-nav">Navigation</div>
                <div class="demo-target" data-tour-id="demo-search">Search</div>
                <div class="demo-target" data-tour-id="demo-profile">Profile</div>
              </div>
              <button class="demo-run" id="run-basic">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Run Demo
              </button>
              <button class="code-toggle" data-target="code-basic">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                View Code
              </button>
              <div class="demo-code" id="code-basic">
                <pre><code class="language-typescript">tours.register({
  id: 'basic',
  name: 'Basic Tour',
  trigger: 'manual',
  steps: [
    { target: 'nav',     title: 'Navigation', message: 'Move between pages.',   placement: 'bottom' },
    { target: 'search',  title: 'Search',     message: 'Find anything.',        placement: 'bottom' },
    { target: 'profile', title: 'Profile',    message: 'Manage your account.',  placement: 'bottom' },
  ],
});</code></pre>
              </div>
            </div>

            <!-- Rich content demo -->
            <div class="demo-content" id="demo-rich">
              <div class="demo-row">
                <div class="demo-target" data-tour-id="demo-editor">Editor Area</div>
                <div class="demo-target" data-tour-id="demo-toolbar">Toolbar</div>
              </div>
              <button class="demo-run" id="run-rich">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Run Demo
              </button>
              <button class="code-toggle" data-target="code-rich">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                View Code
              </button>
              <div class="demo-code" id="code-rich">
                <pre><code class="language-typescript">import { html } from 'lit';

tours.register({
  id: 'rich',
  name: 'Rich Content',
  trigger: 'manual',
  steps: [
    {
      target: 'editor',
      title: 'Editor',
      message: html`Use &lt;strong&gt;bold&lt;/strong&gt;, &lt;em&gt;italic&lt;/em&gt;,
                     and &lt;code&gt;code&lt;/code&gt; formatting.`,
      placement: 'bottom',
    },
    {
      target: 'toolbar',
      title: 'Toolbar',
      message: html`Shortcuts: &lt;kbd&gt;Ctrl+B&lt;/kbd&gt; Bold
                     &lt;kbd&gt;Ctrl+I&lt;/kbd&gt; Italic`,
      placement: 'bottom',
    },
  ],
});</code></pre>
              </div>
            </div>

            <!-- Auto-advance demo -->
            <div class="demo-content" id="demo-auto">
              <div class="demo-row">
                <div class="demo-target" data-tour-id="demo-slide-1">Slide 1</div>
                <div class="demo-target" data-tour-id="demo-slide-2">Slide 2</div>
                <div class="demo-target" data-tour-id="demo-slide-3">Slide 3</div>
              </div>
              <button class="demo-run" id="run-auto">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Run Demo
              </button>
              <button class="code-toggle" data-target="code-auto">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                View Code
              </button>
              <div class="demo-code" id="code-auto">
                <pre><code class="language-typescript">tours.register({
  id: 'kiosk',
  name: 'Kiosk Demo',
  trigger: 'manual',
  loop: true,                           // restart from step 0
  steps: [
    { target: 'slide-1', title: 'Slide 1', message: 'Auto-advances.', placement: 'bottom', autoAdvance: 2500 },
    { target: 'slide-2', title: 'Slide 2', message: 'No clicks needed.', placement: 'bottom', autoAdvance: 2500 },
    { target: 'slide-3', title: 'Slide 3', message: 'Loops back.',      placement: 'bottom', autoAdvance: 2500 },
  ],
});</code></pre>
              </div>
            </div>

            <!-- Shapes demo -->
            <div class="demo-content" id="demo-shapes">
              <div class="demo-row">
                <div class="demo-avatar" data-tour-id="demo-avatar">T</div>
                <div class="demo-target" style="border-radius: 9999px; padding: 0.5rem 1.25rem;" data-tour-id="demo-pill">Pill Element</div>
                <div class="demo-target" data-tour-id="demo-square">Square</div>
              </div>
              <button class="demo-run" id="run-shapes">
                <svg viewBox="0 0 24 24" width="12" height="12" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                Run Demo
              </button>
              <button class="code-toggle" data-target="code-shapes">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>
                View Code
              </button>
              <div class="demo-code" id="code-shapes">
                <pre><code class="language-typescript">tours.register({
  id: 'shapes',
  name: 'Spotlight Shapes',
  trigger: 'manual',
  steps: [
    { target: 'avatar', title: 'Circle', message: 'Circular cutout.', placement: 'bottom', spotlightBorderRadius: '50%' },
    { target: 'pill',   title: 'Pill',   message: 'Pill shape.',      placement: 'bottom', spotlightBorderRadius: '9999px' },
    { target: 'square', title: 'Square', message: 'Sharp corners.',   placement: 'bottom', spotlightBorderRadius: '0' },
  ],
});</code></pre>
              </div>
            </div>
          </div>
        </div>

        <div class="search-bar-wrap" data-tour-id="styling-search">
          <div class="search-bar">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" placeholder="Jump to property or section…" id="styling-search-input" autocomplete="off" />
          </div>
          <div class="api-search-results" id="styling-search-results"></div>
        </div>

        <!-- CSS Custom Properties -->
        <div class="doc-section" data-tour-id="styling-props">
          <h2 class="section-title" id="ref-css-props">CSS Custom Properties</h2>
          <p class="doc-text">
            Set these on <code>:root</code> or on <code>torchlit-overlay</code> directly.
            Each <code>--tour-*</code> variable falls back to a generic design token, then to a hardcoded default.
          </p>
          <table class="ref-table">
            <thead><tr><th>Property</th><th>Fallback</th><th>Default</th><th>Used for</th></tr></thead>
            <tbody>
              <tr><td><code>--tour-primary</code></td><td><code>--primary</code></td><td><code>#F26122</code></td><td>Accent color, progress dots, pulse ring</td></tr>
              <tr><td><code>--tour-primary-foreground</code></td><td><code>--primary-foreground</code></td><td><code>#fff</code></td><td>Text on primary-colored elements</td></tr>
              <tr><td><code>--tour-card</code></td><td><code>--card</code></td><td><code>#fff</code></td><td>Tooltip and center-card background</td></tr>
              <tr><td><code>--tour-foreground</code></td><td><code>--foreground</code></td><td><code>#1a1a1a</code></td><td>Title and body text</td></tr>
              <tr><td><code>--tour-muted-foreground</code></td><td><code>--muted-foreground</code></td><td><code>#737373</code></td><td>Step counter, secondary text</td></tr>
              <tr><td><code>--tour-muted</code></td><td><code>--muted</code></td><td><code>#e5e5e5</code></td><td>Inactive progress dots, button hover</td></tr>
              <tr><td><code>--tour-border</code></td><td><code>--border</code></td><td><code>#e5e5e5</code></td><td>Tooltip and button borders</td></tr>
              <tr><td><code>--tour-background</code></td><td><code>--background</code></td><td><code>#fff</code></td><td>Secondary button background</td></tr>
              <tr><td><code>--tour-spotlight-radius</code></td><td><code>--radius-lg</code></td><td><code>0.75rem</code></td><td>Spotlight border-radius</td></tr>
              <tr><td><code>--tour-tooltip-radius</code></td><td><code>--radius-lg</code></td><td><code>0.75rem</code></td><td>Tooltip border-radius</td></tr>
              <tr><td><code>--tour-card-radius</code></td><td><code>--radius-xl</code></td><td><code>1rem</code></td><td>Center-card border-radius</td></tr>
              <tr><td><code>--tour-btn-radius</code></td><td><code>--radius-md</code></td><td><code>0.5rem</code></td><td>Button border-radius</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Theme playground -->
        <div class="doc-section">
          <h2 class="section-title" id="ref-theme-playground">Theme Playground</h2>
          <p class="doc-text">
            Tweak CSS custom property values and see the result in real time.
            Copy the generated CSS when you're happy with the look.
          </p>
          <div class="playground">
            <div class="playground-header">
              <span class="playground-header-title">Live Preview</span>
              <button class="playground-reset" id="pg-reset">Reset</button>
            </div>
            <div class="playground-body">
              <div class="playground-controls" id="pg-controls">
                <!-- Colors -->
                <div class="playground-control">
                  <label>--tour-primary</label>
                  <input type="color" data-pg="primary" value="#F26122" />
                  <input type="text" data-pg-text="primary" value="#F26122" />
                </div>
                <div class="playground-control">
                  <label>--tour-primary-fg</label>
                  <input type="color" data-pg="primary-fg" value="#ffffff" />
                  <input type="text" data-pg-text="primary-fg" value="#ffffff" />
                </div>
                <div class="playground-control">
                  <label>--tour-card</label>
                  <input type="color" data-pg="card" value="#ffffff" />
                  <input type="text" data-pg-text="card" value="#ffffff" />
                </div>
                <div class="playground-control">
                  <label>--tour-foreground</label>
                  <input type="color" data-pg="foreground" value="#1a1a1a" />
                  <input type="text" data-pg-text="foreground" value="#1a1a1a" />
                </div>
                <div class="playground-control">
                  <label>--tour-border</label>
                  <input type="color" data-pg="border" value="#e5e5e5" />
                  <input type="text" data-pg-text="border" value="#e5e5e5" />
                </div>
                <div class="playground-control">
                  <label>--tour-muted</label>
                  <input type="color" data-pg="muted" value="#e5e5e5" />
                  <input type="text" data-pg-text="muted" value="#e5e5e5" />
                </div>
                <div class="playground-control">
                  <label>--tour-muted-fg</label>
                  <input type="color" data-pg="muted-fg" value="#737373" />
                  <input type="text" data-pg-text="muted-fg" value="#737373" />
                </div>
                <div class="playground-control">
                  <label>--tour-background</label>
                  <input type="color" data-pg="background" value="#ffffff" />
                  <input type="text" data-pg-text="background" value="#ffffff" />
                </div>
                <!-- Radii -->
                <div class="playground-control">
                  <label>--tour-tooltip-radius</label>
                  <input type="text" data-pg-text="tooltip-radius" value="0.75rem" style="flex:1" />
                </div>
                <div class="playground-control">
                  <label>--tour-btn-radius</label>
                  <input type="text" data-pg-text="btn-radius" value="0.5rem" style="flex:1" />
                </div>
              </div>
              <div class="playground-preview" id="pg-preview">
                <div class="playground-tooltip-mock">
                  <div class="playground-tooltip-badge">
                    <svg viewBox="0 0 24 24" width="12" height="12" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                    STEP 2 OF 4
                  </div>
                  <div class="playground-tooltip-title">Navigation</div>
                  <div class="playground-tooltip-message">Use the sidebar to move between pages.</div>
                  <div class="playground-tooltip-dots">
                    <span class="playground-tooltip-dot completed"></span>
                    <span class="playground-tooltip-dot active"></span>
                    <span class="playground-tooltip-dot"></span>
                    <span class="playground-tooltip-dot"></span>
                  </div>
                  <div class="playground-tooltip-footer">
                    <span class="playground-tooltip-skip">Skip tour</span>
                    <div class="playground-tooltip-nav">
                      <button class="playground-btn-secondary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg>
                        Back
                      </button>
                      <button class="playground-btn-primary">
                        Next
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="playground-code-wrap">
              <button class="playground-code-toggle" id="pg-code-toggle">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
                Copy CSS
              </button>
              <div class="playground-code" id="pg-code">
                <pre><code id="pg-code-output" class="language-css"></code></pre>
              </div>
            </div>
          </div>
        </div>

        <!-- Example: Custom theme -->
        <div class="doc-section" data-tour-id="styling-custom">
          <h2 class="section-title" id="ref-custom-theme">Example: Custom Theme</h2>
          <pre><code class="language-css">:root {
  /* Brand colors */
  --tour-primary: #6366f1;            /* Indigo */
  --tour-primary-foreground: #fff;

  /* Surface colors */
  --tour-card: #fafafa;
  --tour-foreground: #18181b;
  --tour-border: #e4e4e7;

  /* Rounder corners */
  --tour-spotlight-radius: 1rem;
  --tour-tooltip-radius: 1rem;
  --tour-btn-radius: 9999px;          /* Pill buttons */
}</code></pre>
        </div>

        <!-- Dark mode -->
        <div class="doc-section" data-tour-id="styling-dark">
          <h2 class="section-title" id="ref-dark-mode">Dark Mode</h2>
          <p class="doc-text">
            If your app uses a <code>.dark</code> class or <code>prefers-color-scheme</code> media query,
            just override the fallback tokens. Torchlit picks them up automatically.
          </p>
          <pre><code class="language-css">:root.dark {
  --primary: #FF8C59;
  --primary-foreground: #1a1a1a;
  --card: #252525;
  --foreground: #e8e8e8;
  --border: #3a3a3a;
  --muted: #2f2f2f;
  --muted-foreground: #9ca3af;
}

/* Or use --tour-* for overlay-only overrides */
:root.dark {
  --tour-primary: #FF8C59;
  --tour-card: #252525;
}</code></pre>
        </div>

        <!-- CSS Parts -->
        <div class="doc-section" data-tour-id="styling-parts">
          <h2 class="section-title" id="ref-css-parts">CSS ::part() Selectors</h2>
          <p class="doc-text">
            For deeper customization beyond colors, use <code>::part()</code> to style internal elements.
            See the <a href="#" onclick="switchPage('api');return false" style="color:var(--primary)">API Reference</a> for the full list of parts.
          </p>
          <pre><code class="language-css">/* Larger tooltip shadow */
torchlit-overlay::part(tooltip) {
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
}

/* Custom backdrop opacity */
torchlit-overlay::part(backdrop) {
  background: rgba(0, 0, 0, 0.7);
}

/* Glow effect on spotlight */
torchlit-overlay::part(spotlight) {
  box-shadow: 0 0 0 4px rgba(242, 97, 34, 0.3);
}</code></pre>
        </div>
      </div>

    </main>
  </div>

  <!-- ── Tour overlay (the library component) ──────────────────── -->
  <torchlit-overlay></torchlit-overlay>

  <!-- ── Prism.js syntax highlighting ──────────────────────────── -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>

  <!-- ── Application script ────────────────────────────────────── -->
  <script type="module">
    import { createTourService, TorchlitOverlay } from '../src/index.ts';
    import { html as litHtml } from 'lit';

    // Ensure the custom element registration survives tree-shaking
    if (!customElements.get('torchlit-overlay')) {
      customElements.define('torchlit-overlay', TorchlitOverlay);
    }

    // ── Create a tour service instance ──────────────────────────────

    const tours = createTourService({ storageKey: 'torchlit-docs' });

    // ── Wire the overlay to the service ─────────────────────────────

    const overlay = document.querySelector('torchlit-overlay');
    overlay.service = tours;

    // ── Page navigation ─────────────────────────────────────────────

    function switchPage(name) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      const page = document.getElementById(`page-${name}`);
      const nav = document.querySelector(`.nav-item[data-page="${name}"]`);
      if (page) page.classList.add('active');
      if (nav) nav.classList.add('active');
    }

    // Make switchPage available globally for inline onclick handlers
    window.switchPage = switchPage;

    document.querySelectorAll('.nav-item').forEach(btn => {
      btn.addEventListener('click', () => {
        switchPage(btn.dataset.page);
        // Close mobile sidebar when a nav item is clicked
        closeMobileSidebar();
      });
    });

    // ── Mobile sidebar toggle ───────────────────────────────────────

    const sidebar = document.querySelector('.sidebar');
    const sidebarBackdrop = document.getElementById('sidebar-backdrop');
    const menuToggle = document.getElementById('btn-menu');

    function closeMobileSidebar() {
      sidebar.classList.remove('open');
      sidebarBackdrop.classList.remove('visible');
    }

    menuToggle.addEventListener('click', () => {
      const isOpen = sidebar.classList.toggle('open');
      sidebarBackdrop.classList.toggle('visible', isOpen);
    });

    sidebarBackdrop.addEventListener('click', closeMobileSidebar);

    // Handle route changes from tour steps
    overlay.addEventListener('tour-route-change', (e) => {
      switchPage(e.detail.route);
    });

    // ── Define tours ────────────────────────────────────────────────

    tours.register([
      // ── 1. Onboarding — auto-starts on first visit ────────────────
      {
        id: 'onboarding',
        name: 'Welcome Tour',
        trigger: 'first-visit',
        steps: [
          {
            target: '_none_',
            title: 'Welcome to the Torchlit Docs!',
            message:
              'This site is both the documentation and a live demo of Torchlit. ' +
              'Let\'s take a quick tour. Use arrow keys or click Next.',
            placement: 'bottom',
          },
          {
            target: 'nav-overview',
            title: 'Overview',
            message:
              'The docs home page with install instructions, key stats, ' +
              'and a quick-start snippet.',
            placement: 'right',
          },
          {
            target: 'overview-stats',
            title: 'At a Glance',
            message:
              'Key metrics about Torchlit — bundle size, dependencies, ' +
              'and framework support. The spotlight highlights exactly what you need.',
            placement: 'bottom',
            beforeShow: () => switchPage('overview'),
          },
          {
            target: 'overview-features',
            title: 'Key Features',
            message:
              'Shadow DOM traversal, framework-agnostic design, CSS theming, ' +
              'and a tiny bundle. These cards detail what makes Torchlit different.',
            placement: 'top',
            beforeShow: () => switchPage('overview'),
          },
          {
            target: 'nav-guide',
            title: 'Getting Started',
            message:
              'The step-by-step setup guide — install, configure, and launch your first tour.',
            placement: 'right',
          },
          {
            target: 'nav-recipes',
            title: 'Recipes',
            message:
              'Ready-to-copy patterns for React, Vue, Svelte, kiosk mode, ' +
              'multi-page apps, shadow DOM targets, and more.',
            placement: 'right',
          },
          {
            target: 'guide-demo',
            title: 'Interactive Examples',
            message:
              'The spotlight followed you to a new page! ' +
              'Try these live demos — each one shows a different Torchlit feature with its code.',
            placement: 'top',
            beforeShow: () => switchPage('styling'),
          },
          {
            target: 'header-help',
            title: 'Contextual Help',
            message:
              'Click the ? button anytime for page-specific help. ' +
              'Each section has its own help tour. You\'re all set!',
            placement: 'bottom',
            beforeShow: () => switchPage('overview'),
          },
        ],
        onComplete: () => console.log('[docs] Onboarding complete!'),
        onSkip: () => console.log('[docs] Onboarding skipped'),
      },

      // ── 2. Contextual help tours (manual) ─────────────────────────
      {
        id: 'overview-help',
        name: 'Overview Help',
        trigger: 'manual',
        steps: [
          {
            target: 'overview-stats',
            title: 'Quick Stats',
            message:
              'Key metrics about Torchlit at a glance — bundle size, ' +
              'peer dependency, and framework support.',
            placement: 'bottom',
          },
          {
            target: 'overview-features',
            title: 'Feature Highlights',
            message:
              'Each card describes a core feature. Hover them for ' +
              'a subtle lift effect — all CSS, no JavaScript.',
            placement: 'top',
          },
          {
            target: 'header-theme',
            title: 'Theme Toggle',
            message:
              'Switch between light and dark mode. The tour overlay adapts ' +
              'automatically via CSS custom properties — zero config.',
            placement: 'bottom',
          },
        ],
      },
      {
        id: 'guide-help',
        name: 'Getting Started Help',
        trigger: 'manual',
        steps: [
          {
            target: 'guide-search',
            title: 'Search Docs',
            message: 'Filter the guide steps by keyword — type to narrow down what you need.',
            placement: 'bottom',
          },
          {
            target: 'nav-styling',
            title: 'See It In Action',
            message:
              'Head to the Styling page for interactive examples you can run live, ' +
              'plus a theme playground and CSS custom property reference.',
            placement: 'right',
          },
        ],
      },
      {
        id: 'api-help',
        name: 'API Reference Help',
        trigger: 'manual',
        steps: [
          {
            target: 'api-search',
            title: 'Jump to Symbol',
            message:
              'Type a method name, property, or type to jump straight to it — ' +
              'works like Cmd+K. Try "nextStep" or "autoAdvance".',
            placement: 'bottom',
          },
          {
            target: 'api-service',
            title: 'Quick Navigation',
            message:
              'Use these pills to jump to any section: TourService, Overlay, Types, or deepQuery.',
            placement: 'bottom',
          },
        ],
      },
      {
        id: 'styling-help',
        name: 'Styling Help',
        trigger: 'manual',
        steps: [
          {
            target: 'guide-demo',
            title: 'Interactive Examples',
            message:
              'Run live demos right here and click View Code to see the configuration behind each one.',
            placement: 'top',
          },
          {
            target: 'styling-search',
            title: 'Search',
            message:
              'Jump to any CSS property or section — start typing to filter.',
            placement: 'bottom',
          },
          {
            target: 'styling-props',
            title: 'CSS Custom Properties',
            message:
              'All the CSS variables you can set — each has a --tour-* prefix, ' +
              'a generic fallback, and a sensible default.',
            placement: 'top',
          },
          {
            target: 'styling-dark',
            title: 'Dark Mode',
            message:
              'Override the fallback tokens in a .dark class or prefers-color-scheme ' +
              'media query — zero JS needed.',
            placement: 'top',
          },
          {
            target: 'styling-parts',
            title: '::part() Selectors',
            message:
              'For deeper customization beyond colors — change shadows, borders, ' +
              'or add glow effects to the spotlight.',
            placement: 'top',
          },
        ],
      },
      {
        id: 'recipes-help',
        name: 'Recipes Help',
        trigger: 'manual',
        steps: [
          {
            target: 'recipes-search',
            title: 'Search Recipes',
            message:
              'Type a keyword like "React", "kiosk", or "shadow" to filter recipes instantly.',
            placement: 'bottom',
          },
          {
            target: 'recipes-frameworks',
            title: 'Framework Integration',
            message:
              'Ready-to-copy setup code for React, Vue, Svelte, and plain JS/TS.',
            placement: 'top',
          },
          {
            target: 'recipes-spa',
            title: 'SPA & Routing',
            message:
              'Patterns for tours that span multiple views in single-page apps.',
            placement: 'top',
          },
          {
            target: 'recipes-kiosk',
            title: 'Kiosk Mode',
            message:
              'Auto-advancing, looping tours for demos and digital signage.',
            placement: 'top',
          },
          {
            target: 'recipes-storage',
            title: 'Custom Storage',
            message:
              'Swap localStorage for sessionStorage or an API-backed adapter.',
            placement: 'top',
          },
        ],
      },
    ]);

    // ── Map pages to help tours ─────────────────────────────────────

    const helpMap = {
      overview: 'overview-help',
      guide: 'guide-help',
      recipes: 'recipes-help',
      api: 'api-help',
      styling: 'styling-help',
    };

    // ── Button handlers ─────────────────────────────────────────────

    // Help — start contextual tour for current page
    document.getElementById('btn-help').addEventListener('click', () => {
      const activePage = document.querySelector('.nav-item.active')?.dataset.page || 'overview';
      const tourId = helpMap[activePage];
      if (tourId) tours.start(tourId);
    });

    // Theme toggle
    document.getElementById('btn-theme').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });

    // Reset — clear tour state and reload to re-trigger onboarding
    document.getElementById('btn-reset').addEventListener('click', () => {
      tours.resetAll();
      location.reload();
    });

    // ── Guide search (client-side filter) ─────────────────────────

    const guideSearch = document.querySelector('[data-tour-id="guide-search"] input');
    if (guideSearch) {
      guideSearch.addEventListener('input', (e) => {
        const query = e.target.value.trim().toLowerCase();
        const guidePage = document.getElementById('page-guide');
        if (!guidePage) return;

        const sections = guidePage.querySelectorAll('.step, .doc-section');
        sections.forEach(section => {
          if (!query) { section.style.display = ''; return; }
          const text = section.textContent?.toLowerCase() ?? '';
          section.style.display = text.includes(query) ? '' : 'none';
        });
      });
    }

    // ── Recipes search (client-side filter) ────────────────────────

    const recipesSearch = document.getElementById('recipes-search-input');
    if (recipesSearch) {
      recipesSearch.addEventListener('input', (e) => {
        const query = e.target.value.trim().toLowerCase();
        const recipesPage = document.getElementById('page-recipes');
        if (!recipesPage) return;

        // Filter top-level sections and subsections independently
        const sections = recipesPage.querySelectorAll('.doc-section');
        sections.forEach(section => {
          const subs = section.querySelectorAll('.recipe-sub');
          if (subs.length === 0) {
            // No subsections — filter the whole section
            if (!query) { section.style.display = ''; return; }
            const text = section.textContent?.toLowerCase() ?? '';
            section.style.display = text.includes(query) ? '' : 'none';
          } else {
            // Has subsections — filter each individually
            let anyVisible = false;
            subs.forEach(sub => {
              if (!query) { sub.style.display = ''; anyVisible = true; return; }
              const text = sub.textContent?.toLowerCase() ?? '';
              const match = text.includes(query);
              sub.style.display = match ? '' : 'none';
              if (match) anyVisible = true;
            });
            // Also check the section heading/intro text
            if (!query) { section.style.display = ''; return; }
            const introText = (section.querySelector('.section-title')?.textContent ?? '').toLowerCase() +
                              (section.querySelector('.section-title + .doc-text')?.textContent ?? '').toLowerCase();
            if (introText.includes(query)) anyVisible = true;
            section.style.display = anyVisible ? '' : 'none';
          }
        });
      });
    }

    // ── API search (jump-to method / property / type) ─────────────

    const apiSearchInput = document.getElementById('api-search-input');
    const apiSearchResults = document.getElementById('api-search-results');

    if (apiSearchInput && apiSearchResults) {
      const apiPage = document.getElementById('page-api');
      const searchIndex = [];

      if (apiPage) {
        // Index table rows
        apiPage.querySelectorAll('.ref-table tbody tr').forEach(tr => {
          const codeEl = tr.querySelector('code');
          if (!codeEl) return;
          const label = codeEl.textContent ?? '';
          let context = '';
          let prev = tr.closest('table')?.previousElementSibling;
          while (prev) {
            if (prev.classList?.contains('subsection-title') || prev.classList?.contains('section-title')) {
              context = prev.textContent ?? '';
              break;
            }
            prev = prev.previousElementSibling;
          }
          searchIndex.push({ label, context, element: tr, text: (label + ' ' + (tr.textContent ?? '')).toLowerCase() });
        });

        // Index subsection headings
        apiPage.querySelectorAll('.subsection-title').forEach(h3 => {
          const label = h3.textContent ?? '';
          searchIndex.push({ label, context: 'Section', element: h3, text: label.toLowerCase() });
        });
      }

      let activeIdx = -1;

      function getMatches(q) {
        return searchIndex
          .filter(item => item.text.includes(q))
          .sort((a, b) => {
            const aPrefix = a.label.toLowerCase().startsWith(q) ? 0 : 1;
            const bPrefix = b.label.toLowerCase().startsWith(q) ? 0 : 1;
            return aPrefix - bPrefix || a.label.localeCompare(b.label);
          })
          .slice(0, 8);
      }

      function renderResults(matches) {
        apiSearchResults.replaceChildren();
        if (matches.length === 0) {
          apiSearchResults.classList.remove('open');
          activeIdx = -1;
          return;
        }
        activeIdx = 0;
        matches.forEach((m, i) => {
          const row = document.createElement('div');
          row.className = 'api-search-result' + (i === 0 ? ' active' : '');
          row.dataset.idx = String(i);
          const code = document.createElement('code');
          code.textContent = m.label;
          row.appendChild(code);
          if (m.context) {
            const ctx = document.createElement('span');
            ctx.className = 'result-context';
            ctx.textContent = m.context;
            row.appendChild(ctx);
          }
          row.addEventListener('click', () => jumpTo(m));
          apiSearchResults.appendChild(row);
        });
        apiSearchResults.classList.add('open');
      }

      function jumpTo(match) {
        apiSearchResults.classList.remove('open');
        apiSearchInput.value = '';
        match.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        match.element.classList.remove('highlight-flash');
        void match.element.offsetWidth;
        match.element.classList.add('highlight-flash');
        setTimeout(() => match.element.classList.remove('highlight-flash'), 1600);
      }

      apiSearchInput.addEventListener('input', () => {
        const q = apiSearchInput.value.trim().toLowerCase();
        if (!q) { renderResults([]); return; }
        renderResults(getMatches(q));
      });

      apiSearchInput.addEventListener('keydown', (e) => {
        const items = apiSearchResults.querySelectorAll('.api-search-result');
        if (!items.length) return;

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          items[activeIdx]?.classList.remove('active');
          activeIdx = (activeIdx + 1) % items.length;
          items[activeIdx]?.classList.add('active');
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          items[activeIdx]?.classList.remove('active');
          activeIdx = (activeIdx - 1 + items.length) % items.length;
          items[activeIdx]?.classList.add('active');
        } else if (e.key === 'Enter') {
          e.preventDefault();
          const q = apiSearchInput.value.trim().toLowerCase();
          const matches = getMatches(q);
          if (matches[activeIdx]) jumpTo(matches[activeIdx]);
        } else if (e.key === 'Escape') {
          renderResults([]);
          apiSearchInput.blur();
        }
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('[data-tour-id="api-search"]')) {
          apiSearchResults.classList.remove('open');
        }
      });
    }

    // ── Theme playground ──────────────────────────────────────────────

    (function initPlayground() {
      const preview = document.getElementById('pg-preview');
      const codeOutput = document.getElementById('pg-code-output');
      const codeWrap = document.getElementById('pg-code');
      const codeToggle = document.getElementById('pg-code-toggle');
      const resetBtn = document.getElementById('pg-reset');
      if (!preview) return;

      const varMap = {
        'primary':          { css: '--tour-primary',            pg: '--pg-primary' },
        'primary-fg':       { css: '--tour-primary-foreground', pg: '--pg-primary-fg' },
        'card':             { css: '--tour-card',               pg: '--pg-card' },
        'foreground':       { css: '--tour-foreground',         pg: '--pg-foreground' },
        'border':           { css: '--tour-border',             pg: '--pg-border' },
        'muted':            { css: '--tour-muted',              pg: '--pg-muted' },
        'muted-fg':         { css: '--tour-muted-foreground',   pg: '--pg-muted-fg' },
        'background':       { css: '--tour-background',         pg: '--pg-background' },
        'tooltip-radius':   { css: '--tour-tooltip-radius',     pg: '--pg-tooltip-radius' },
        'btn-radius':       { css: '--tour-btn-radius',         pg: '--pg-btn-radius' },
      };

      const defaults = {
        'primary': '#F26122', 'primary-fg': '#ffffff', 'card': '#ffffff',
        'foreground': '#1a1a1a', 'border': '#e5e5e5', 'muted': '#e5e5e5',
        'muted-fg': '#737373', 'background': '#ffffff',
        'tooltip-radius': '0.75rem', 'btn-radius': '0.5rem',
      };

      const state = { ...defaults };

      function applyToPreview() {
        Object.keys(state).forEach(key => {
          const mapping = varMap[key];
          if (mapping) preview.style.setProperty(mapping.pg, state[key]);
        });
      }

      function generateCSS() {
        const changed = Object.keys(state).filter(k => state[k] !== defaults[k]);
        if (changed.length === 0) return '/* No changes — using defaults */';
        const lines = changed.map(k => `  ${varMap[k].css}: ${state[k]};`);
        return `torchlit-overlay {\n${lines.join('\n')}\n}`;
      }

      function updateCodeOutput() {
        codeOutput.textContent = generateCSS();
        if (typeof Prism !== 'undefined') Prism.highlightElement(codeOutput);
      }

      // Sync color input <-> text input
      function syncInputs(key, value) {
        state[key] = value;
        const colorInput = document.querySelector(`[data-pg="${key}"]`);
        const textInput = document.querySelector(`[data-pg-text="${key}"]`);
        if (colorInput && colorInput.value !== value) colorInput.value = value;
        if (textInput && textInput.value !== value) textInput.value = value;
        applyToPreview();
        updateCodeOutput();
      }

      // Color pickers
      document.querySelectorAll('[data-pg]').forEach(input => {
        input.addEventListener('input', () => syncInputs(input.dataset.pg, input.value));
      });

      // Text inputs
      document.querySelectorAll('[data-pg-text]').forEach(input => {
        input.addEventListener('input', () => {
          const key = input.dataset.pgText;
          state[key] = input.value;
          const colorInput = document.querySelector(`[data-pg="${key}"]`);
          if (colorInput) {
            // Only sync to color picker if it's a valid hex
            if (/^#[0-9a-f]{6}$/i.test(input.value)) colorInput.value = input.value;
          }
          applyToPreview();
          updateCodeOutput();
        });
      });

      // Code toggle — copy to clipboard
      codeToggle.addEventListener('click', () => {
        const css = generateCSS();
        navigator.clipboard.writeText(css).then(() => {
          const orig = codeToggle.innerHTML;
          codeToggle.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg> Copied!';
          setTimeout(() => { codeToggle.innerHTML = orig; }, 1500);
        });
        // Also toggle code display
        codeWrap.classList.toggle('open');
      });

      // Reset
      resetBtn.addEventListener('click', () => {
        Object.keys(defaults).forEach(k => syncInputs(k, defaults[k]));
      });

      // Initial render
      applyToPreview();
      updateCodeOutput();
    })();

    // ── Styling search (reuses jump-to pattern) ─────────────────────

    const stylingSearchInput = document.getElementById('styling-search-input');
    const stylingSearchResults = document.getElementById('styling-search-results');

    if (stylingSearchInput && stylingSearchResults) {
      const stylingPage = document.getElementById('page-styling');
      const stylingIndex = [];

      if (stylingPage) {
        stylingPage.querySelectorAll('.ref-table tbody tr').forEach(tr => {
          const codeEl = tr.querySelector('code');
          if (!codeEl) return;
          const label = codeEl.textContent ?? '';
          let context = '';
          let prev = tr.closest('table')?.previousElementSibling;
          while (prev) {
            if (prev.classList?.contains('subsection-title') || prev.classList?.contains('section-title')) {
              context = prev.textContent ?? '';
              break;
            }
            prev = prev.previousElementSibling;
          }
          stylingIndex.push({ label, context, element: tr, text: (label + ' ' + (tr.textContent ?? '')).toLowerCase() });
        });

        stylingPage.querySelectorAll('.section-title').forEach(h2 => {
          const label = h2.textContent ?? '';
          stylingIndex.push({ label, context: 'Section', element: h2, text: label.toLowerCase() });
        });
      }

      let stylingActiveIdx = -1;

      function getStylingMatches(q) {
        return stylingIndex
          .filter(item => item.text.includes(q))
          .sort((a, b) => {
            const aPrefix = a.label.toLowerCase().startsWith(q) ? 0 : 1;
            const bPrefix = b.label.toLowerCase().startsWith(q) ? 0 : 1;
            return aPrefix - bPrefix || a.label.localeCompare(b.label);
          })
          .slice(0, 8);
      }

      function renderStylingResults(matches) {
        stylingSearchResults.replaceChildren();
        if (matches.length === 0) {
          stylingSearchResults.classList.remove('open');
          stylingActiveIdx = -1;
          return;
        }
        stylingActiveIdx = 0;
        matches.forEach((m, i) => {
          const row = document.createElement('div');
          row.className = 'api-search-result' + (i === 0 ? ' active' : '');
          row.dataset.idx = String(i);
          const code = document.createElement('code');
          code.textContent = m.label;
          row.appendChild(code);
          if (m.context) {
            const ctx = document.createElement('span');
            ctx.className = 'result-context';
            ctx.textContent = m.context;
            row.appendChild(ctx);
          }
          row.addEventListener('click', () => jumpToStyling(m));
          stylingSearchResults.appendChild(row);
        });
        stylingSearchResults.classList.add('open');
      }

      function jumpToStyling(match) {
        stylingSearchResults.classList.remove('open');
        stylingSearchInput.value = '';
        match.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        match.element.classList.remove('highlight-flash');
        void match.element.offsetWidth;
        match.element.classList.add('highlight-flash');
        setTimeout(() => match.element.classList.remove('highlight-flash'), 1600);
      }

      stylingSearchInput.addEventListener('input', () => {
        const q = stylingSearchInput.value.trim().toLowerCase();
        if (!q) { renderStylingResults([]); return; }
        renderStylingResults(getStylingMatches(q));
      });

      stylingSearchInput.addEventListener('keydown', (e) => {
        const items = stylingSearchResults.querySelectorAll('.api-search-result');
        if (!items.length) return;

        if (e.key === 'ArrowDown') {
          e.preventDefault();
          items[stylingActiveIdx]?.classList.remove('active');
          stylingActiveIdx = (stylingActiveIdx + 1) % items.length;
          items[stylingActiveIdx]?.classList.add('active');
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          items[stylingActiveIdx]?.classList.remove('active');
          stylingActiveIdx = (stylingActiveIdx - 1 + items.length) % items.length;
          items[stylingActiveIdx]?.classList.add('active');
        } else if (e.key === 'Enter') {
          e.preventDefault();
          const q = stylingSearchInput.value.trim().toLowerCase();
          const matches = getStylingMatches(q);
          if (matches[stylingActiveIdx]) jumpToStyling(matches[stylingActiveIdx]);
        } else if (e.key === 'Escape') {
          renderStylingResults([]);
          stylingSearchInput.blur();
        }
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('[data-tour-id="styling-search"]')) {
          stylingSearchResults.classList.remove('open');
        }
      });
    }


    // ── Interactive demo panel ─────────────────────────────────────

    // Tab switching
    document.querySelectorAll('.demo-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.demo-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.demo-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('demo-' + tab.dataset.demo)?.classList.add('active');
      });
    });

    // Code toggle buttons
    document.querySelectorAll('.code-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const target = document.getElementById(btn.dataset.target);
        if (target) {
          const isVisible = target.classList.toggle('visible');
          btn.querySelector('svg').style.transform = isVisible ? 'rotate(90deg)' : '';
        }
      });
    });

    // Register demo tours
    tours.register([
      {
        id: 'demo-basic',
        name: 'Basic Demo',
        trigger: 'manual',
        steps: [
          { target: 'demo-nav', title: 'Navigation', message: 'The main navigation bar lets you move between pages.', placement: 'bottom' },
          { target: 'demo-search', title: 'Search', message: 'Quickly find anything with the global search.', placement: 'bottom' },
          { target: 'demo-profile', title: 'Profile', message: 'Manage your account settings here.', placement: 'bottom' },
        ],
      },
      {
        id: 'demo-rich',
        name: 'Rich Content Demo',
        trigger: 'manual',
        steps: [
          {
            target: 'demo-editor',
            title: 'Editor',
            message: litHtml`Write content here. Use <strong>bold</strong>, <em>italic</em>, and <code>code</code> formatting.`,
            placement: 'bottom',
          },
          {
            target: 'demo-toolbar',
            title: 'Toolbar',
            message: litHtml`Shortcuts: <kbd>Ctrl+B</kbd> Bold &nbsp; <kbd>Ctrl+I</kbd> Italic &nbsp; <kbd>Ctrl+K</kbd> Link`,
            placement: 'bottom',
          },
        ],
      },
      {
        id: 'demo-auto',
        name: 'Auto-Advance Demo',
        trigger: 'manual',
        loop: true,
        steps: [
          { target: 'demo-slide-1', title: 'Slide 1', message: 'This tour auto-advances every 2.5 seconds.', placement: 'bottom', autoAdvance: 2500 },
          { target: 'demo-slide-2', title: 'Slide 2', message: 'No clicks needed — perfect for kiosk / demo modes.', placement: 'bottom', autoAdvance: 2500 },
          { target: 'demo-slide-3', title: 'Slide 3', message: 'With loop: true, it restarts from the beginning.', placement: 'bottom', autoAdvance: 2500 },
        ],
      },
      {
        id: 'demo-shapes',
        name: 'Shapes Demo',
        trigger: 'manual',
        steps: [
          { target: 'demo-avatar', title: 'Circle', message: 'spotlightBorderRadius: "50%" gives a circular cutout.', placement: 'bottom', spotlightBorderRadius: '50%' },
          { target: 'demo-pill', title: 'Pill', message: 'spotlightBorderRadius: "9999px" creates a pill shape.', placement: 'bottom', spotlightBorderRadius: '9999px' },
          { target: 'demo-square', title: 'Square', message: 'spotlightBorderRadius: "0" for sharp corners.', placement: 'bottom', spotlightBorderRadius: '0' },
        ],
      },
    ]);

    // Wire up run buttons
    document.getElementById('run-basic')?.addEventListener('click', () => tours.start('demo-basic'));
    document.getElementById('run-rich')?.addEventListener('click', () => tours.start('demo-rich'));
    document.getElementById('run-auto')?.addEventListener('click', () => tours.start('demo-auto'));
    document.getElementById('run-shapes')?.addEventListener('click', () => tours.start('demo-shapes'));

    // ── Auto-start onboarding on first visit ────────────────────────

    if (tours.shouldAutoStart('onboarding')) {
      setTimeout(() => tours.start('onboarding'), 800);
    }
  </script>
</body>
</html>
